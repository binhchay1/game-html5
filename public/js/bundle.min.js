(() => {
    var Oe = Object.create, de = Object.defineProperty, Fe = Object.getOwnPropertyDescriptor, pe = Object.getOwnPropertyNames, Ue = Object.getPrototypeOf, Ae = Object.prototype.hasOwnProperty, qe = (t, e) => function () { return e || (0, t[pe(t)[0]])((e = { exports: {} }).exports, e), e.exports }, We = (t, e, r, n) => { if (e && typeof e == "object" || typeof e == "function") for (let i of pe(e)) !Ae.call(t, i) && i !== r && de(t, i, { get: () => e[i], enumerable: !(n = Fe(e, i)) || n.enumerable }); return t }, he = (t, e, r) => (r = t != null ? Oe(Ue(t)) : {}, We(e || !t || !t.__esModule ? de(r, "default", { value: t, enumerable: !0 }) : r, t)), _e = qe({ "coffee/bundle/_react.js"() { var t, e, r, n = {}.hasOwnProperty, i = [].slice; window.R || (t = {}, e = function (o, a) { var s; for (s in o) if (n.call(o, s) && o[s] !== a[s]) return !0; for (s in a) if (n.call(a, s) && !(s in o)) return !0; return !1 }, r = {}, window.R = function (o, a, s, u) { var l, c, p, h, v, y; return s == null && (s = R), u == null && (u = ""), s[o] ? (I.in_dev && console.warn("Already declared, using existing:", o), s[o]) : (a.trigger = function () { var w; w = $(ReactDOM.findDOMNode(this)), R.trigger.apply(R, [w].concat(i.call(arguments))) }, a.dispatch = function () { var w; w = $(ReactDOM.findDOMNode(this)), R.dispatch.apply(R, [w].concat(i.call(arguments))) }, a.container = function () { return $(ReactDOM.findDOMNode(this)) }, a.extend_props = function () { var w; return w = 1 <= arguments.length ? i.call(arguments, 0) : [], $.extend.apply($, [{}, this.props].concat(i.call(w))) }, a.tt = function (w, k) { var x; return k == null && (k = t), (x = I.i18n.fetch_key_sync(w)) && _.isString(x) ? x : (r[w] || (r[w] = I.i18n.react_class(w)), React.createElement(r[w], k)) }, a.t = function (w, k) { return I.i18n.fetch_key_sync(w) ? I.i18n.t_sync(w, k) : (I.i18n.fetch_key(w).done(function (x) { return function () { if (x.isMounted()) return x.forceUpdate() } }(this)), "\u2026") }, c = _.once(function () { return ("" + u + o).replace(/[A-Z]/g, "_$&").replace(/\./g, "_").replace(/__+/g, "_").replace(/^_+/, "").replace(/_+$/, "").toLowerCase() + "_widget" }), a.enclosing_class_name = c, a.enclose = function () { var w, k, x; return x = arguments[0], w = 2 <= arguments.length ? i.call(arguments, 1) : [], k = x.component || "div", delete x.component, React.createElement.apply(React, [k, $.extend({}, x, { className: classNames(c(), x.className) })].concat(i.call(w))) }, a.displayName = "" + u + o, a.pure && (a.shouldComponentUpdate = function (w, k) { return e(this.props || t, w) || e(this.state || t, k) }), p = a.getDefaultProps, delete a.getDefaultProps, y = a.propTypes, delete a.propTypes, h = a.getDerivedStateFromError, delete a.getDerivedStateFromError, l = createReactClass(a), p && (l.defaultProps = p()), y && (l.propTypes = y), h && (l.getDerivedStateFromError = h), v = React.createElement.bind(null, l), v.type = l, s[o] = v) }, R.scope_event_name = function (o) { return "itch:" + o }, R.trigger = function () { var o, a, s; return s = arguments[0], a = arguments[1], o = 3 <= arguments.length ? i.call(arguments, 2) : [], s.trigger(R.scope_event_name(a), i.call(o)) }, R.dispatch = function (o, a, s) { var u, l, c; typeof a == "object" && (s = a, a = !1), c = []; for (u in s) n.call(s, u) && (l = s[u], a && (u = a + ":" + u), c.push(o.on(R.scope_event_name(u), l))); return c }, R.component = function () { return R.apply(null, arguments) }, R.is_different = e, R.package = function (o) { var a; return a = R[o] || (R[o] = function (s, u) { return u.Package = a, R.component(s, u, a, o + ".") }), a.component = function () { return a.apply(null, arguments) }, a }, R.render = function (o, a) { var s; return window.ReactDOM ? (s = typeof o == "string" ? document.querySelector(o) : o, ReactDOM.render(a(), s)) : I.libs.react.done(function () { return R.render(o, a) }) }) } }), J, ge, me, Be = {}.hasOwnProperty, re = [].slice; ge = 10, J = "inputmemory_keys", me = 1, window.I = { get_worker: function () { var t; return t = $.Deferred(), I.get_worker = function () { return t }, t.resolve(new Worker("/static/worker.min.js")), t }, solve_challenge: function (t) { return I.get_worker().then(function (e) { var r, n, i; return r = me++, e.postMessage([r, "solve_challenge", t]), n = $.Deferred(), e.addEventListener("message", i = function (o) { return function (a) { var s, u, l; if (u = a.data, s = u[0], l = u[1], s === r) return e.removeEventListener("message", i), n.resolve(l) } }(this)), n }) }, libs: { react: $.Deferred(function (t) { if (typeof React != "undefined" && React !== null) return t.resolve(React) }), selectize: $.Deferred(function (t) { var e; if (typeof $ != "undefined" && $ !== null && (e = $.fn) != null && e.selectize) return t.resolve($.fn.selectize) }), redactor: $.Deferred(function (t) { var e; if (typeof $ != "undefined" && $ !== null && (e = $.fn) != null && e.redactor) return t.resolve($.fn.redactor) }) }, setup_page: function () { return I.setup_register_referrers($(document.body)), _.defer(function (t) { return function () { return I.setup_affiliate_code() } }(this)) }, root_url: function () { var t; return t = null, function (e) { return t || (t = $("body").data("host") || "", t !== "" && (t = window.location.protocol + "//" + t, window.location.port && window.location.port !== "80" && (t += ":" + window.location.port))), t + "/" + e } }(), page_name: function () { return $(document.body).data("page_name") || "unknown" }, sort_keys: function (t) { var e, r; return r = [], e = function (n) { var i, o, a; o = []; for (i in n) Be.call(n, i) && (a = n[i], r.push(i), typeof a == "object" ? o.push(e(a)) : o.push(void 0)); return o }, e(t), r.sort() }, get_csrf: function () { return I._csrf_token || (I._csrf_token = $("meta[name='csrf_token']").attr("value")) }, with_csrf: function (t) { var e; return t == null && (t = {}), e = { csrf_token: I.get_csrf() }, typeof t == "string" ? t + "&" + $.param(e) : $.extend(t, e) }, add_params: function (t, e) { var r; return r = $.param(e), t.match(/\?/) ? t + "&" + r : t + "?" + r }, flash: function (t, e) { return e == null && (e = "notice"), I.flasher || (I.flasher = new I.Flasher), t.match(/^error:/) && (t = t.replace(/^error:/, "Error: "), e = "error"), I.flasher.show(e, t) }, slugify: function (t, e) { return t = t.replace(/\s+/g, "-"), t = e != null && e.for_tags ? t.replace(/[^\w_.-]/g, "").replace(/^[_.-]+/, "").replace(/[_.-]+$/, "") : t.replace(/[^\w_-]/g, ""), t.toLowerCase() }, truncate: function (t, e, r) { return e == null && (e = 30), r == null && (r = "..."), t ? t.length > e + r.length ? "" + t.slice(0, e) + r : t : "" }, number_format: function (t, e, r, n) { var i, o, a; return r == null && (r = "."), n == null && (n = ","), isNaN(t) || t === null ? "" : (t = t.toFixed(~~e), a = t.split("."), o = a[0], i = a[1] ? r + a[1] : "", o.replace(/(\d)(?=(?:\d{3})+$)/g, "$1" + n) + i) }, format_bytes: function () { var t; return t = [["gb", Math.pow(1024, 3)], ["mb", Math.pow(1024, 2)], ["kb", 1024]], function (e) { var r, n, i, o, a; for (r = 0, i = t.length; r < i; r++)if (a = t[r], n = a[0], o = a[1], e >= o) return "" + I.number_format(e / o) + n; return I.number_format(e) + " bytes" } }(), ecommerce_event: function (t) { return window.ga ? (ga("ecommerce:addTransaction", t.transaction), ga("ecommerce:addItem", t.item), ga("ecommerce:send")) : console.log("ecommerce event:", t) }, event: function (t, e, r, n, i) { var o; return i == null && (i = !0), o = { hitType: "event", eventCategory: t, eventAction: e, eventLabel: r, eventValue: n }, i || (o.nonInteraction = 1), I.event_with_opts(o) }, event_with_opts: function (t) { try { return typeof ga != "undefined" && ga !== null ? ga("send", t) : (console.log("event:", t), typeof t.hitCallback == "function" ? t.hitCallback() : void 0) } catch (e) { } }, event2: function () { var t; t = 1 <= arguments.length ? re.call(arguments, 0) : [] }, parse_money: function (t) { var e; return e = t && parseInt(t.replace(/[^\d]/g, ""), 10), e || 0 }, currency_symbols: { USD: "$", GBP: "\xA3", EUR: "\u20AC", JPY: "\xA5" }, currency_formats: { USD: { prefix: "$" }, GBP: { prefix: "\xA3" }, JPY: { prefix: "\xA5" }, EUR: { suffix: "\u20AC" } }, format_money: function (t, e) { var r, n; return e == null && (e = "USD"), t < 0 ? "-" + I.format_money(-t, e) : (n = I.currency_symbols[e] || "$", e === "JPY" ? n + t : (r = I.number_format(t / 100, 2), e === "EUR" ? "" + r + n : "" + n + r)) }, money_input: function (t, e) { var r, n; return e == null && (e = {}), t = $(t), r = e.currency || t.data("currency"), n = I.currency_formats[r] || { prefix: "$" }, t.maskMoney($.extend({ affixesStay: !0, precision: r === "JPY" ? 0 : 2 }, n, e)) }, plural: function (t, e) { return e === 1 ? e + " " + t : e + " " + t + "s" }, add_recaptcha_if_necessary: function (t, e) { if (e[0] === "recaptcha") return t.data("adding_recaptcha") || (t.data("adding_recaptcha", !0), I.with_recaptcha(function () { var r; return r = t.find(".g-recaptcha"), I.event("recaptcha", "show", I.page_name()), grecaptcha.render(r[0], { sitekey: r.data("sitekey") }) })), t.set_form_errors(["Please fill out the CAPTCHA to continue"]), !0 }, with_recaptcha: function (t) { var e; return window.grecaptcha ? t() : I.recaptcha_deferred ? I.recaptcha_deferred.done(t) : (I.recaptcha_deferred = $.Deferred().done(t), window._itch_recaptcha_loaded = function () { return I.recaptcha_deferred.resolve() }, e = "https://www.google.com/recaptcha/api.js?onload=_itch_recaptcha_loaded&render=explicit", $('<script type="text/javascript">').attr("src", e).appendTo("head")) }, wait_for_object: function (t, e, r) { var n, i, o; return i = 1, n = 10, o = function () { return t[e] ? typeof r == "function" ? r() : void 0 : (i += n, i = Math.min(500, i), setTimeout(o, i)) }, o() }, with_selectize: function (t) { return I.libs.selectize.done(t) }, get_template: function (t) { return _.template($("#" + t + "_tpl").html()) }, lazy_template: function (t, e) { return function () { var r, n; return r = 1 <= arguments.length ? re.call(arguments, 0) : [], n = I.get_template(e), t.prototype.template = n, n.apply(null, r) } }, setup_sticky_bar: function (t) { var e, r, n; return n = $(window), e = $(document.body), t = $(t), r = !1, n.on("scroll", function (i) { if (n.scrollTop() > t.offset().top + t.outerHeight()) { if (!r) return e.addClass("show_sticky_bar"), r = !0 } else if (r) return e.removeClass("show_sticky_bar"), r = !1 }) }, setup_selectize: function (t) { return t.find(".selectize_input").each(function (e, r) { var n, i, o, a, s, u, l; if (n = $(r), !n.hasClass("selectized")) return s = { plugins: [], persist: !1 }, n.is("select") && (i = {}, n.find("option").each(function (c, p) { var h; return h = $(p), i[h.val()] = h.data("extra") }), l = function (c, p) { var h, v; return h = p(c.text), (v = i[c.value]) && (h = h + " <span class='sub'>\u2014 " + v + "</span>"), "<div class='option'>" + h + "</div>" }, s.render = { item: l, option: l }), (u = n.data("placeholder")) && (s.placeholder = u), n.hasClass("dropdown") && (s.maxItems = 1), (a = n.data("options")) && (n.hasClass("options_object") ? (s.options = a, s.searchField = ["text", "keywords"]) : s.options = a.map(function (c) { return { value: c[0], text: c[1] } }), s.plugins.push("remove_button"), s.delimiter = ",", s.persist = !1), (o = n.data("optgroups")) && (s.optgroups = o), n.selectize(s) }) }, format_filesize: function (t, e) { var r, n, i, o, a; for (e == null && (e = ".file_size_value"), o = t.find(e), a = [], n = 0, i = o.length; n < i; n++)r = o[n], r = $(r), a.push(r.html(I.format_bytes(parseInt(r.html())))); return a }, adjust_font_size_to_fit: function (t, e) { var r, n, i; if (e == null && (e = 16), !!t.length) { for (n = t.css("font-size"), n = parseInt(n.match(/\d+/), 10), r = t[0], i = []; r.offsetWidth < r.scrollWidth && (n -= 2, !(n < e));)i.push(t.css("font-size", n + "px")); return i } }, slug_input: function (t, e) { var r; if (r = /[a-z_0-9_-]/g, t.on("keypress", function (n) { var i; if (n.keyCode >= 32 && (i = String.fromCharCode(n.keyCode), !i.match(r))) return !1 }), e && e.length) return t.on("change", function (n) { var i; if (i = I.slugify(e.val()), t.val().match(/^\s*$/) && i !== "") return t.val(i) }), e.on("change", function (n) { if (t.val().match(/^\s*$/)) return t.val(I.slugify($(n.currentTarget).val())) }) }, deferred_links: function (t, e, r) { return r || (r = I.delegate_tracking), t.on("mouseup", e, function (n) { var i; if (n.which === 2) return i = $(n.currentTarget), r(i, n) }), t.on("click", e, function (n) { var i, o, a, s; if (n.which === 1 && (s = $(n.currentTarget), o = n.metaKey || n.ctrlKey || n.shiftKey || s.attr("target") === "_blank", i = null, o || (i = function () { if (i) return i = null, window.location = s.attr("href") }, setTimeout(function () { return typeof i == "function" ? i() : void 0 }, 200)), (a = r(s, n)) != null && a.done(i), !o)) return !1 }) }, delegate_tracking: function (t) { var e; return e = [], t.trigger("i:delegate_tracking", [function (r) { return e.push(r) }]), $.when.apply($, e) }, ga_tracker: function (t, e, r, n) { var i; return i = function (o) { var a, s, u, l, c; return a = { hitType: "event", eventCategory: (s = o.data("category")) != null ? s : t, eventAction: (u = o.data("action")) != null ? u : e, eventLabel: (l = o.data("label")) != null ? l : r, eventValue: (c = o.data("value")) != null ? c : n }, $.Deferred(function (p) { return a.hitCallback = function () { return p.resolve() }, I.event_with_opts(a) }) } }, tracked_links: function () { var t, e, r, n, i, o, a; return r = arguments[0], i = 2 <= arguments.length ? re.call(arguments, 1) : [], e = i[0], t = i[1], n = i[2], a = i[3], o = I.ga_tracker(e, t, n, a), I.deferred_links(r, "a[data-label]", o), r.on("i:track_link", function (s, u) { var l; return u && (l = u[0]), I.ga_tracker(e, t, l != null ? l : n, a)($(s.target)) }) }, set_cookie: function (t, e, r) { return r == null && (r = {}), I.in_dev && console.log("set cookie:", [t, e], r), Cookies.set(t, e, $.extend({ path: "/", domain: "." + $(document.body).data("host") }, r)) }, set_register_referrer: function (t) { var e; if (e = I.page_name(), e != null && I.set_cookie("ref:register:page_params", e), t != null) return I.set_cookie("ref:register:action", t) }, setup_register_referrers: function (t) { if (!I.current_user) return t.on("mouseup", "[data-register_action]", function (e) { var r; return r = $(e.currentTarget).data("register_action"), I.set_register_referrer(r) }) }, setup_affiliate_code: function (t, e) { var r, n; if (e == null && (e = !1), t == null && (t = (n = window.location.search.match(/\bac=([\w\d]+(?:\-[\.:_\w\d]+)?)/)) != null ? n[1] : void 0), !!t && !(!e && t === Cookies.get("acode"))) return I.set_cookie("acode", t, { expires: 1 }), document.referrer && I.set_cookie("acode:ref", document.referrer.substring(0, 180), { expires: 1 }), r = window.location.href.replace(/\?.*$/, "").substring(0, 180), I.set_cookie("acode:land", r, { expires: 1 }) }, bind_checkbox_to_input: function (t, e, r) { var n; return n = function () { var i; return i = t.prop("checked"), e.prop("disabled", i), typeof r == "function" ? r(i) : void 0 }, t.on("change", n), n() }, add_facebook: function (t) { var e, r, n; if (!window.FB && (I.add_facebook = function () { }, $('<div id="fb-root"></div>').appendTo(document.body), r = "facebook-jssdk", !document.getElementById(r))) return t != null && (window.fbAsyncInit = t), e = document.getElementsByTagName("script")[0], n = document.createElement("script"), n.id = r, n.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=537395183072744&version=v2.0", e.parentNode.insertBefore(n, e) }, add_twitter: function () { var t, e, r; if (e = "twitter-wjs", !document.getElementById(e)) return I.add_twitter = function () { }, t = document.getElementsByTagName("script")[0], r = document.createElement("script"), r.id = "twitter-wjs", r.src = "//platform.twitter.com/widgets.js", t.parentNode.insertBefore(r, t) }, add_react: function () { var t, e; return t = $.Deferred(), window.ReactDOM ? (t.resolve(), t) : (I.add_react = function () { return t }, I.libs.react.done(function () { return t.resolve() }), e = $("#lib_react_src"), e.replaceWith($('<script type="text/javascript">').attr("src", e.data("src"))), t) }, has_follow_button: function (t, e) { var r, n, i, o, a, s, u; return e == null && (e = {}), t = $(t), i = (a = e.cls) != null ? a : "follow_button_widget", r = (s = e.animate_follow) != null ? s : "animate_bounce", n = (u = e.animate_unfollow) != null ? u : "animate_drop_down", o = {}, o[i] = function (l) { var c, p, h, v; if (!I.current_user) return "continue"; if (!l.is(".loading")) return l.removeClass(r + " " + n), h = $.Deferred(function (y) { return setTimeout(function () { return y.resolve() }, 500) }), p = l.is(".is_following"), v = p ? (_.defer(function () { return l.addClass(n) }), l.data("unfollow_url")) : (_.defer(function () { return l.addClass(r) }), l.data("follow_url")), l.addClass("loading").trigger("i:track_link", ["follow_btn"]), c = l.data("follow_data") || {}, $.when($.post(v, I.with_csrf(c)), h).done(function (y) { var w; if (w = y[0], l.removeClass("loading " + r + " " + n), w.errors) { I.flash(w.errors.join(", ")); return } return l.toggleClass("is_following", w.following).trigger("i:follow_updated", [{ user_id: l.data("user_id"), following: w.following, btn: l }]) }) }, t.dispatch("click", o), $(document.body).on("i:follow_updated", function (l, c) { var p, h, v; return v = c.user_id, h = c.following, p = c.btn, t.find("." + i + "[data-user_id=" + v + "]").not(p).toggleClass("is_following", h) }) }, is_mobile: function () { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) }, is_ios: function () { return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream }, strip_css: function (t) { return t.replace(/<\s*\/\s*style\s*>/i, "") }, request_fullscreen: function (t, e) { var r, n, i; return r = t.requestFullscreen ? (t.requestFullscreen(), !0) : t.msRequestFullscreen ? (t.msRequestFullscreen(), !0) : t.mozRequestFullScreen ? (t.mozRequestFullScreen(), !0) : t.webkitRequestFullscreen ? (t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT), !0) : !1, r && e && (n = window.screen) != null && (i = n.orientation) != null && typeof i.lock == "function" && i.lock(e), r }, is_fullscreen: function () { return !(!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) }, exit_fullscreen: function () { if (document.exitFullscreen) return document.exitFullscreen(); if (document.msExitFullscreen) return document.msExitFullscreen(); if (document.mozCancelFullScreen) return document.mozCancelFullScreen(); if (document.webkitExitFullscreen) return document.webkitExitFullscreen() }, toggle_fullscreen: function (t, e) { return I.is_fullscreen() ? (I.exit_fullscreen(), !1) : I.request_fullscreen(t, e) ? !0 : "failed" }, setup_dirty_warning: function (t, e) { return e || (e = function () { return t.data("dirty") }), t.data("dirty", !1), $(window).on("beforeunload", function () { var r; if (r = e(), !!r) switch (typeof r) { case "string": return r; default: return "You've made modifications to this page." } }), t.on("i:after_submit", function () { return t.data("dirty", !1) }), _.defer(function () { return t.on("change", "input, select, textarea", function (r) { return t.data("dirty", !0) }), t.on("keydown, mousedown", ".redactor-editor", function () { return t.data("dirty", !0) }) }) }, remote_submit: function (t, e, r) { var n, i; return r == null && (r = {}), t.trigger("i:before_submit"), r.loading_lock && (i = t.serializeArray(), n = t.addClass("loading").find("button, input[type='submit']").prop("disabled", !0).addClass("disabled")), $.when(e).then(function (o) { var a; return i || (i = t.serializeArray()), o && (i = i.concat(o)), $.ajax({ data: i, type: (a = t.attr("method")) != null ? a : "POST", dataType: "json", url: t.attr("action"), xhrFields: { withCredentials: !0 }, error: function (s) { var u; return u = function () { try { return JSON.parse(s.responseText) } catch (l) { } }(), u != null && u.errors ? I.flash(u.errors.join(", ")) : I.flash("We seem to be having server problems right now! Please try again later.") }, complete: function () { return r.loading_lock && (n.prop("disabled", !1).removeClass("disabled"), t.removeClass("loading")), t.trigger("i:after_submit") } }).then(null, function (s) { try { return JSON.parse(s.responseText) } catch (u) { throw s } }) }) }, is_middle_click: function (t) { return t.which === 2 || t.metaKey || t.ctrlKey }, escape_regex: function (t) { return t.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&") }, move: function (t, e, r) { var n, i, o, a; if (i = t.indexOf(e), i === -1) throw "Failed to find object in array"; if (a = i + r, a < 0 || a >= t.length) throw "Movement is outside of array (" + a + ") [0, " + (t.length - 1) + "]"; return n = function () { var s, u, l; for (l = [], s = 0, u = t.length; s < u; s++)o = t[s], o !== e && l.push(o); return l }(), n.splice(a, 0, e), n }, format_integer: function (t) { return t > 1e7 ? Math.floor(t / 1e6) + "m" : t >= 1e6 ? Math.floor(t / 1e5) / 10 + "m" : t > 1e4 ? Math.floor(t / 1e3) + "k" : t >= 1e3 ? Math.floor(t / 100) / 10 + "k" : "" + t }, store_memory: function (t, e) { var r, n, i, o; if (window.localStorage) { if (i = function () { try { return JSON.parse(localStorage.getItem(J)) } catch (a) { } }(), i || (i = []), i[0] !== t) { for (n = function () { var a, s, u; for (u = [], a = 0, s = i.length; a < s; a++)r = i[a], t !== r && u.push(r); return u }(), i = [t].concat(n); i.length > ge;)o = i.pop(), typeof localStorage != "undefined" && localStorage !== null && localStorage.removeItem(o); localStorage.setItem(J, JSON.stringify(i)) } return localStorage.setItem(t, e) } }, clear_memory: function (t) { var e, r; if (window.localStorage) { r = function () { try { return JSON.parse(localStorage.getItem(J)) } catch (n) { } }(), r && localStorage.setItem(J, JSON.stringify(function () { var n, i, o; for (o = [], n = 0, i = r.length; n < i; n++)e = r[n], t !== e && o.push(e); return o }())); try { return localStorage.removeItem(t) } catch (n) { } } } }, $(function () { var t; if ((t = window.location.hash.match(/\bflash=([^&]*)/)) && (I.flash(t[1]), window.location.hash = window.location.hash.replace(/\bflash=([^&]*)/, "")), I.ie) return $(document.body).addClass("ie") }), I.Flasher = function () { t.prototype.duration = 1e4, t.prototype.animation_duration = 250, t.prototype.clipping = "-7px"; function t() { $(document).on("click", ".global_flash", function (e) { return function () { return e.dismiss() } }(this)) } return t.prototype.dismiss = function () { var e; if (e = this.current_flash) return this.timeout && (clearTimeout(this.timeout), this.timeout = null), e.css({ "margin-top": "-" + (e.outerHeight() + 4) + "px" }), setTimeout(function (r) { return function () { return e.remove() } }(this), this.animation_duration * 2) }, t.prototype.show = function (e, r) { var n; return this.dismiss(), n = $("<div class='global_flash " + e + "' role='alert' aria-live='polite'>").text(r).appendTo("body"), n.css({ "margin-left": "-" + n.width() / 2 + "px", "margin-top": "-" + (n.outerHeight() + 4) + "px" }), this.timeout = setTimeout(function (i) { return function () { return n.addClass("animated"), n.css({ "margin-top": i.clipping }), setTimeout(function () { return i.dismiss() }, i.duration) } }(this), 100), this.current_flash = n }, t }(), _.templateSettings = { escape: /\{\{(?![&])(.+?)\}\}/g, interpolate: /\{\{&(.+?)\}\}/g, evaluate: /<%([\s\S]+?)%>/g }, $.easing.smoothstep = function (t) { return t * t * t * (t * (t * 6 - 15) + 10) }; var K, H = K = window.dayjs; window._dayjs_setup || (K.extend(window.dayjs_plugin_duration), K.extend(window.dayjs_plugin_calendar), K.extend(window.dayjs_plugin_advancedFormat), K.extend(window.dayjs_plugin_relativeTime), window._dayjs_setup = !0); var ne, Ge = [].slice; ne = function (t) { var e; return (e = typeof t == "string" && t.match(/(^\d{4}\-\d{1,2}\-\d{1,2}) (\d{1,2}:\d{1,2}:\d{1,2})$/)) ? e[1] + "T" + e[2] + "Z" : t }; var ve = function (t) { return H(ne(t)).toDate() }, we = function () { var t, e, r, n; switch (n = arguments[0], e = arguments[1], t = 3 <= arguments.length ? Ge.call(arguments, 2) : [], e == null && (e = "fromNow"), n = ne(n), e) { case "fromNow": return H(n).fromNow(); case "calendar": return H(n).calendar(null, { sameElse: "MMMM Do YYYY" }); case "format": return (r = H(n)).format.apply(r, t); default: throw new Error("unknown method for format_timestamp: " + e) } }, ye; $.fn.dispatch = function (t, e) { return this.on(t, function (r) { return function (n) { var i, o, a, s; for (a in e) if (o = e[a], i = $(n.target).closest("." + a), !!i.length) return i.is(".disabled") ? !1 : i.is("a") && n.ctrlKey || (s = o(i, n), s === "continue") ? void 0 : !1; return null } }(this)), this }, $.fn.exists = function () { return this.length > 0 ? this : !1 }, $.fn.format_timestamps = function (t) { var e, r, n, i, o; for (t == null && (t = "calendar"), o = this.find(".date_format"), r = function (a) { var s, u, l; return s = a.data("format"), u = a.html(), l = s ? we(u, "format", s) : we(u, t), a.html(l).attr("title", u + " UTC") }, n = 0, i = o.length; n < i; n++)e = o[n], r($(e)); return this }, $.fn.has_tooltips = function (t) { var e, r, n, i, o, a; if (t == null && (t = {}), !I.is_mobile()) return o = function () { var s; return s = $('<div class="tooltip_drop"></div>'), $(document.body).append(s), o = function () { return s }, s }, a = _.template('<div class="tooltip">{{ label }}</div>'), i = function (s, u) { var l, c, p, h; return u == null && (u = !1), l = s.data("tooltip_el"), l || (l = $(a({ label: s.attr("aria-label") || s.data("tooltip") })), s.data("tooltip_el", l)), l.removeClass("visible"), o().empty().append(l), p = s.offset(), c = l.outerHeight(), h = l.outerWidth(), l.css({ position: "absolute", top: t.below ? p.top + s.outerHeight() + 10 : p.top - c - 10, left: Math.floor(p.left + (s.outerWidth() - h) / 2) }), l.toggleClass("below", !!t.below), u ? l.addClass("visible") : setTimeout(function (v) { return function () { return l.addClass("visible") } }(this), 10) }, r = function (s) { return function (u) { var l, c; if (c = $(u.currentTarget), l = c.data("tooltip_el"), c.removeData("tooltip_el"), !!l && l.is(":visible")) return i(c, !0) } }(this), n = function (s) { return function (u) { var l; if (l = $(u.currentTarget), !l.closest(".redactor-box").length) return i(l) } }(this), e = function (s) { return function (u) { var l, c; if (c = $(u.currentTarget), l = c.data("tooltip_el")) return l.remove() } }(this), this.is("[data-tooltip]") ? (this.on("i:refresh_tooltip", r), this.on("mouseenter focus", n), this.on("mouseleave blur i:hide_tooltip", e)) : (this.on("i:refresh_tooltip", "[data-tooltip], [aria-label]", r), this.on("i:clear_tooltips", function () { return o().empty() }), this.on("mouseenter focus", "[data-tooltip], [aria-label]", n), this.on("mouseleave blur i:hide_tooltip", "[data-tooltip], [aria-label]", e)), this }, $.fn.inline_edit = function (t) { var e, r, n; if (t == null && (t = {}), this.is(".inline_editing")) { this.data("finished_editing")(); return } return this.addClass("inline_editing"), r = $('<input type="text" class="inline_edit_input" />').attr("placeholder", this.data("placeholder")).val((typeof t.get_val == "function" ? t.get_val(this) : void 0) || this.text()).insertAfter(this.hide()).select(), e = function (i) { return function () { return r.remove(), i.show(), $(document).off("click.inline_editing"), i.removeClass("inline_editing") } }(this), this.data("finished_editing", e), n = function (i) { return function () { return r.prop("disabled", !0), t.set_val ? t.set_val(i, r.val(), e) : (i.text(r.val()), e()) } }(this), $(document).on("click.edit_title", function (i) { return function (o) { if (!$(o.target).closest(".inline_edit_input").length) return n() } }(this)), r.on("keydown", function (i) { return function (o) { switch (o.keyCode) { case 9: return _.defer(function () { return n() }); case 13: return n(); case 27: return e() } } }(this)) }, I.support_passive_scroll = function () { var t, e; e = !1; try { t = Object.defineProperty({}, "passive", { get: function (r) { return function () { return e = !0 } }(this) }), window.addEventListener("test", null, t) } catch (r) { } return e }, I.support_intersection_observer = function () { return "IntersectionObserver" in window }, ye = function (t, e) { var r, n, i, o, a, s, u, l; for (t.removeClass("lazy_images"), n = t.find("[data-background_image]").addBack("[data-background_image]"), o = function () { var c, p, h; for (h = [], c = 0, p = n.length; c < p; c++)r = n[c], h.push(function (v) { var y; if (v = $(v), y = v.data("background_image"), v.css({ backgroundImage: "url(" + y + ")" }), e) return $.Deferred(function (w) { return function (k) { return $("<img />").attr("src", y).on("load", function () { return k.resolve() }) } }(this)) }(r)); return h }(), l = t.find("img[data-lazy_src]").addBack("img[data-lazy_src]"), i = function (c) { var p, h; if (c = $(c), p = c.data("lazy_src"), c.attr("src", p), (h = c.data("lazy_srcset")) && c.attr("srcset", h), e) return $.Deferred(function (v) { return function (y) { return c.on("load", function () { return y.resolve() }) } }(this)) }, s = 0, u = l.length; s < u; s++)a = l[s], i(a); if (e) return o.length === 1 ? o[0] : $.when.apply($, o) }, $.fn.lazy_images = function (t) { var e, r, n, i, o, a, s, u, l, c, p, h, v, y, w, k; if (p = this.data("lazy_images")) return p(); if (u = t != null && t.elements ? function () { var x, S, C, f; for (C = t.elements, f = [], x = 0, S = C.length; x < S; x++)n = C[x], f.push($(n)); return f }() : (h = (t != null ? t.selector : void 0) || ".lazy_images", function () { var x, S, C, f; for (C = this.find(h), f = [], x = 0, S = C.length; x < S; x++)n = C[x], f.push($(n)); return f }.call(this)), e = (c = t != null ? t.show_images : void 0) != null ? c : ye, I.support_intersection_observer()) { for (i = function (x) { var S, C, f, d, g, b; for (b = [], f = 0, d = x.length; f < d; f++)C = x[f], C.isIntersecting ? (n = C.target, a.unobserve(n), n = $(n), g = t != null ? t.show_item : void 0, S = e(n, !!g), b.push(typeof g == "function" ? g(n, S) : void 0)) : b.push(void 0); return b }, a = new IntersectionObserver(i, {}), s = 0, l = u.length; s < l; s++)n = u[s], a.observe(n[0]); return function () { return a.disconnect() } } return k = $(window), v = t != null ? t.target : void 0, o = t != null ? t.horizontal : void 0, w = null, r = function (x) { return function () { var S, C, f, d, g, b, j, L, T; for (S = function () { if (v) { if (o) return v.outerWidth() + v.position().left; throw new Error("not yet") } else return k.scrollTop() + k.height() }(), f = 0, d = b = 0, j = u.length; b < j; d = ++b)if (g = u[d], !!g) { if (!document.body.contains(g[0])) { u[d] = null, f += 1; continue } T = function () { if (v) { if (o) return g.position().left; throw new Error("not yet") } else return g.offset().top }(), g[0].offsetParent && T < S && (L = t != null ? t.show_item : void 0, C = e(g, !!L), typeof L == "function" && L(g, C), f += 1, u[d] = null) } if (f > 0) return u = function () { var E, P, N; for (N = [], E = 0, P = u.length; E < P; E++)n = u[E], n && N.push(n); return N }() } }(this), y = _.throttle(r, 100), v ? (v.on("scroll", y), k.on("resize", y), w = function () { return v.off("scroll", y), k.off("resize", "throttled") }) : I.support_passive_scroll() ? (window.addEventListener("scroll", y, { passive: !0 }), k.on("resize i:reshape", y), w = function () { return window.removeEventListener("scroll", y, { passive: !0 }), k.off("resize", y) }) : (k.on("scroll resize i:reshape", y), w = function () { return k.off("scroll resize i:reshape", y) }), this.data("lazy_images", function (x) { return function () { return u = t != null && t.elements ? function () { var S, C, f, d; for (f = t.elements, d = [], S = 0, C = f.length; S < C; S++)n = f[S], d.push($(n)); return d }() : (h = (t != null ? t.selector : void 0) || ".lazy_images", function () { var S, C, f, d; for (f = this.find(h), d = [], S = 0, C = f.length; S < C; S++)n = f[S], d.push($(n)); return d }.call(x)), r() } }(this)), r(), w }, $.fn.max_height = function (t) { var e, r, n; return t == null && (t = 0), n = $(window), e = this.outerHeight(!0) - this.height(), r = function (i) { return function () { return i.css("min-height", n.height() - e - t + "px") } }(this), n.on("resize", r), r() }, $.fn.remote_link = function (t) { return this.on("click", "[data-remote]", function (e) { return function (r) { var n, i, o, a, s; if (r.preventDefault(), i = $(r.currentTarget), !i.is(".loading") && (a = i.data("method") || "POST", s = I.with_csrf($.extend({}, i.data("params"))), o = i.data("href") || i.attr("href"), !((n = i.data("confirm")) && !confirm(n)))) return i.addClass("loading").prop("disabled", !0), $.ajax({ type: a, url: o, data: s, xhrFields: { withCredentials: !0 } }).done(function (u) { return i.removeClass("loading").prop("disabled", !1), typeof t == "function" ? t(u, i) : void 0 }), null } }(this)) }, $.fn.remote_submit = function (t, e, r) { var n; return n = null, this.on("click", "button[name], input[type='submit'][name]", function (i) { return function (o) { var a; return a = $(o.currentTarget), n != null && n.remove(), n = $("<input type='hidden' />").attr("name", a.attr("name")).val(a.attr("value")).prependTo(i) } }(this)), this.on("submit", function (i) { return function (o, a) { var s; if (o.preventDefault(), s = $(o.currentTarget), !(e && !(typeof e == "function" && e(s)))) return I.remote_submit(s, r, { loading_lock: !0 }).done(function (u) { return s.data("dirty", !1), a != null ? a(u, s) : t(u, s) }), null } }(this)) }, $.fn.remote_table = function () { var t, e, r, n; return r = this.data("max_page"), t = function (i) { return function () { return i.data("page") || 1 } }(this), n = {}, e = function (i) { return function (o) { var a, s; if (!i.is(".loading") && 1 <= o && o <= r) return a = i.find("table"), i.addClass("loading").data("page", o).toggleClass("first_page", o === 1).toggleClass("last_page", o === r).find(".current_page").text(o), s = n[o] || (n[o] = $.get(i.data("remote_url") + "?" + $.param({ page: o }))), s.done(function (u) { return i.removeClass("loading"), a.html(u.content) }) } }(this), this.dispatch("click", { next_page_btn: function (i) { return function () { return e(t() + 1) } }(this), prev_page_btn: function (i) { return function () { return e(t() - 1) } }(this) }) }, $.fn.set_form_errors = function (t, e, r) {
        var n, i, o, a, s, u, l, c; if (e == null && (e = !0), r == null && (r = "Errors"), this.find(".form_errors").remove(), s = !!(t != null && t.length), this.toggleClass("has_errors", s), s) {
            for (o = $(_.template(`<div class="form_errors">
  <div>{{ msg }}:</div>
  <ul></ul>
</div>`)({ msg: r })), a = o.find("ul"), u = 0, l = t.length; u < l; u++)i = t[u], a.append($("<li></li>").text(i)); this.prepend(o), e && (c = this.closest(".lightbox"), c.length || this.offset().top > $(window).height() / 2 ? typeof (n = this[0]).scrollIntoView == "function" && n.scrollIntoView() : $("html, body").animate({ scrollTop: 0 }, "fast"))
        } return this
    }, $.fn.swap_with = function (t) { var e, r, n, i, o, a, s, u; if (t = $(t), !!(this.length && t.length)) return r = this.offset(), i = t.offset(), u = this.prop("tagName"), a = t.prop("tagName"), s = $("<" + u + "></" + u + ">").insertAfter(this), o = $("<" + a + "></" + a + ">").insertAfter(t), s.after(t), o.after(this), e = this.offset(), n = t.offset(), o.replaceWith(this.detach().css({ position: "relative", top: r.top - e.top + "px", left: r.left - e.left + "px" })), s.replaceWith(t.detach().css({ position: "relative", top: i.top - n.top + "px", left: i.left - n.left + "px" })), _.defer(function (l) { return function () { return l.css({ top: "", left: "" }), t.css({ top: "", left: "" }) } }(this)) }, $.fn.track_input = function (t, e) { var r, n; return r = this.find(t), n = function (i) { return function () { var o, a, s; return s = function () { var u, l, c; for (c = [], u = 0, l = r.length; u < l; u++)a = r[u], c.push(e + "_" + $(a).attr("value")); return c }(), i.removeClass(s.join(" ")), o = r.serializeArray().map(function (u) { return e + "_" + u.value }), i.addClass(o.join(" ")) } }(this), r.on("change", function (i) { return n() }), n() }; var yt = he(_e()), He, m = He = window.$, O = [].slice, Ye = function (t, e) { for (var r in e) Ve.call(e, r) && (t[r] = e[r]); function n() { this.constructor = t } return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t }, Ve = {}.hasOwnProperty; I.Lightbox && console.warn("I.Lightbox is being double declared"); var Je = I.Lightbox || (I.Lightbox = function () { t.include_dependencies = function (e) { var r; return e ? (r = [], e.redactor && !m.fn.redactor && (m("head").append(e.redactor), r.push(I.libs.redactor)), e.selectize && !m.fn.selectize && (m("head").append(e.selectize), r.push(I.libs.selectize)), r) : [] }, t.lightbox_container = function () { return this._container || (this._container = m("#lightbox_container").exists() || m('<div id="lightbox_container"></div>').appendTo("body")) }, t.shroud_container = function () { return this._shroud || (this._shroud = m("#lightbox_shroud").exists() || m('<div id="lightbox_shroud"></div>').appendTo("body")) }, t.show_shroud = function () { var e; if (!this.shroud_visible) return this._shroud || (e = this.shroud_container(), this.lightbox_container().on("click", function (r) { return function (n) { if (!m(n.target).closest(".lightbox").length) return m(n.target).attr("href") === "javascript:void(0)" ? void 0 : r.close() } }(this)), e.on("click", function (r) { return function () { return r.close() } }(this)), m(document.body).on("keydown", function (r) { return function (n) { return n.keyCode === 27 ? (n.preventDefault(), n.stopPropagation(), r.close()) : r.on_keydown(n) } }(this)), m(window).on("resize", function (r) { return function (n) { return r.on_resize(n) } }(this))), this.shroud_visible = !0, this.shroud_container().addClass("invisible").show(), _.defer(function (r) { return function () { return r.shroud_container().removeClass("invisible") } }(this)) }, t.hide_shroud = function () { return this.shroud_visible = !1, this.shroud_container().hide() }, t.open_loading = function () { return this.open_tpl("loading_lightbox", I.Lightbox) }, t.open_remote_react = function (e, r) { return this.open_loading(), m.when(I.add_react(), m.ajax({ dataType: "json", url: e, data: { props: !0 }, xhrFields: { withCredentials: !0 }, error: function (n) { return function (i, o, a) { var s, u, l; return l = function () { try { return JSON.parse(i.responseText) } catch (c) { } }(), s = (u = l != null ? l.errors : void 0) != null ? u : ["Something went wrong. Please try again later and contact support if it persists."], R.ErrorLightbox ? I.Lightbox.open(R.ErrorLightbox({ errors: s })) : (alert(s.join(",")), n.close()) } }(this) })).done(function (n) { return function (i, o) { var a, s; if (s = o[0], s.errors) { R.ErrorLightbox ? I.Lightbox.open(R.ErrorLightbox(s)) : (alert(s.errors.join(",")), n.close()); return } return a = I.Lightbox.include_dependencies(s._dependencies), m.when.apply(m, [r(s)].concat(O.call(a))).then(function (u) { return u ? I.Lightbox.open(u) : n.close() }) } }(this)) }, t.open_remote = function () { var e, r, n; return n = arguments[0], e = arguments[1], r = 3 <= arguments.length ? O.call(arguments, 2) : [], e == null && (e = I.Lightbox), this.open_loading(), m.ajax({ dataType: "json", url: n, data: { lightbox: !0 }, xhrFields: { withCredentials: !0 }, success: function (i) { return function (o) { if (o.errors) { alert(o.errors.join(",")), i.close(); return } return i.open.apply(i, [o.content, e].concat(O.call(r))) } }(this), error: function (i) { return function (o, a, s) { return alert("Something went wrong. Please try again later and contact support if it persists."), i.close() } }(this) }) }, t.open_tpl = function () { var e, r, n; if (n = arguments[0], e = 2 <= arguments.length ? O.call(arguments, 1) : [], r = m("#" + n + "_tpl"), !r.length) throw "missing template for lightbox: " + n; return this.open.apply(this, [r.html()].concat(O.call(e))) }, t.open_tpl_with_params = function () { var e, r, n, i, o; if (o = arguments[0], i = arguments[1], e = 3 <= arguments.length ? O.call(arguments, 2) : [], r = m("#" + o + "_tpl"), !r.length) throw "missing template for lightbox: " + o; return n = _.template(r.html())(i), this.open.apply(this, [n].concat(O.call(e))) }, t.open = function () { var e, r, n, i, o, a; return n = arguments[0], e = arguments[1], r = 3 <= arguments.length ? O.call(arguments, 2) : [], e == null && (e = I.Lightbox), this.current_lightbox && (this.current_lightbox.close(), this.current_lightbox = null), a = !1, n.$$typeof ? (a = !0, i = new I.ReactLightbox(n, this)) : (typeof n == "string" && (n = m.trim(n)), o = m(n), (i = o.data("object")) || (a = !0, i = function (s, u, l) { l.prototype = s.prototype; var c = new l, p = s.apply(c, u); return Object(p) === p ? p : c }(e, [o, this].concat(O.call(r)), function () { }), o.data("object", i))), m(document.body).addClass("lightbox_open"), this.show_shroud(), i.show(a), this.current_lightbox = i, i }, t.close = function () { var e; if (!(this.current_lightbox && !this.current_lightbox.is_closable()) && !(this.current_lightbox && this.current_lightbox.el.is(".has_changes") && !confirm("You've have unsaved changes in this dialog. Are you sure you want to close it?"))) return this.hide_shroud(), (e = this.current_lightbox) != null && e.close(), this.current_lightbox = null, m(document.body).removeClass("lightbox_open") }, t.on_keydown = function (e) { var r, n; return (r = this.current_lightbox) != null && (n = r.el) != null ? n.trigger("i:lightbox_keydown", e) : void 0 }, t.on_resize = function (e) { var r, n; return (r = this.current_lightbox) != null && (n = r.el) != null ? n.trigger("i:lightbox_resize", e) : void 0 }, t.prototype.lightbox_hidden = function (e) { }; function t() { var e, r, n; e = arguments[0], r = arguments[1], n = 3 <= arguments.length ? O.call(arguments, 2) : [], this.parent = r, this.el = m(e), this.el.on("click", ".close_button, .close_btn", function (i) { return function (o) { return I.Lightbox.close(), !1 } }(this)), this.init.apply(this, n) } return t.prototype.init = function () { }, t.prototype.first_show = function () { }, t.prototype.with_selectize = function (e) { var r; if (!m.fn.selectize) { if (r = this.el.data().selectize, !r) throw "missing selectize include in lightbox"; m("head").append(r) } return I.with_selectize(e) }, t.prototype.with_redactor = function (e) { var r; if (!m.fn.redactor) { if (r = this.el.data().redactor, !r) throw "missing redactor include in lightbox"; m("head").append(r) } return I.libs.redactor.done(e) }, t.prototype.show = function (e) { if (this.el.appendTo(this.parent.lightbox_container()).addClass("animated").show().trigger("i:lightbox_open"), this.position(), e) return this.first_show() }, t.prototype.close = function () { return this.el.removeClass("animated").hide().trigger("i:lightbox_close").remove() }, t.prototype.position = function () { var e; return e = this.parent.lightbox_container().css("position") === "fixed" ? "" : m(window).scrollTop() + "px", this.el.css({ top: e }) }, t.prototype.closable = !0, t.prototype.is_closable = function () { return this.closable }, t }()), bt = I.ReactLightbox || (I.ReactLightbox = function (t) { Ye(e, t); function e() { var r, n, i, o, a, s; r = arguments[0], i = arguments[1], a = 3 <= arguments.length ? O.call(arguments, 2) : [], s = m('<div class="react_lightbox"></div>').appendTo(i.lightbox_container()), o = ReactDOM.render(r, s[0]), n = ReactDOM.findDOMNode(o), e.__super__.constructor.apply(this, [n, i].concat(O.call(a))) } return e.prototype.show = function (r) { return this.el.addClass("animated"), this.position() }, e.prototype.close = function () { var r; return this.el.trigger("i:lightbox_close"), r = this.el.parent(), ReactDOM.unmountComponentAtNode(r[0]), r.remove() }, e }(I.Lightbox)), Ke = function (t, e) { return function () { return t.apply(e, arguments) } }; I.GameCarousel = function () { t.prototype.edge_threshold = 5, t.prototype.margin = 20, t.prototype.inner_padding = 10, t.prototype.paddle_margin_bottom = 30, t.prototype.cell_class = ".game_cell", t.prototype.add_image_loading = function () { return this.el.lazy_images({ show_item: function (e) { return function (r) { return r.trigger("i:impression"), r.find(".image_loading").addBack(".image_loading").removeClass("image_loading") } }(this) }) }; function t(e, r) { this.add_image_loading = Ke(this.add_image_loading, this), this.el = $(e), $.extend(this, r), this.scroll_outer = this.el.find(".scrolling_outer"), this.scroll_inner = this.el.find(".scrolling_inner"), this.paddles = this.el.find(".paddle_next, .paddle_prev"), I.is_mobile() ? (this.el.find(".scrollbar_outer").remove(), this.paddles.remove()) : this.setup_scrollbar(), new I.GameCells(this.el), _.defer(function (n) { return function () { return n.add_image_loading() } }(this)), this.el.dispatch("click", { paddle_next: function (n) { return function (i) { return n.scroll_to(n.cell_offset(n.current_cell() + 3)), i.trigger("i:track_link") } }(this), paddle_prev: function (n) { return function (i) { return n.scroll_to(n.cell_offset(n.current_cell() - 3)), i.trigger("i:track_link") } }(this) }), this.update_height(), $(window).on("resize", _.debounce(function (n) { return function () { return n.update_scrollbar() } }(this), 100)), this.el.on("i:carousel:update_scrollbar", function (n) { return function () { return n.update_scrollbar() } }(this)), _.defer(function (n) { return function () { return n.el.addClass("ready"), n.update_height() } }(this)) } return t.prototype.tallest_child = function () { var e, r, n, i, o, a, s, u; for (s = null, u = null, a = this.scroll_inner.children(), n = i = 0, o = a.length; i < o; n = ++i)e = a[n], e = $(e), s ? (r = e.outerHeight(!0), r > u && (s = e, u = r)) : (s = e, u = e.outerHeight(!0)); return s }, t.prototype.update_height = function () { var e, r; return r = this.tallest_child(), e = r.outerHeight(!0), e += this.inner_padding * 2, this.scroll_outer.css({ height: e + "px" }), this.paddles.css({ height: e - this.paddle_margin_bottom + "px" }), this.update_scrollbar() }, t.prototype.setup_scrollbar = function () { return this.have_scrollbar = !0, this.scrollbar_outer = this.el.find(".scrollbar_outer"), this.scrollbar_inner = this.el.find(".scrollbar_inner"), this.scroll_inner.on("scroll", function (e) { return function () { return e.update_scrollbar() } }(this)), this.scrollbar_inner.draggable({ move: function (e) { return function (r, n) { if (e.unit_scroll) return e.scroll_inner[0].scrollLeft += r * e.unit_scroll } }(this) }), this.update_scrollbar() }, t.prototype.current_cell = function () { var e, r, n, i, o, a; for (r = this.el.find(this.cell_class), n = Math.floor(r.width() / 2), i = o = 0, a = r.length; o < a; i = ++o)if (e = r[i], $(e).position().left + n >= 0) return i; return 0 }, t.prototype.cell_offset = function (e) { var r, n, i; return e = Math.max(0, e), r = this.el.find(this.cell_class + ":eq(" + e + ")"), n = this.max_scroll(), i = r.length ? r.position().left + this.scroll_pos() - this.margin : n, Math.min(i, n) }, t.prototype.scroll_to = function (e) { var r, n; if (!this.scroll_inner.is(":animated")) return r = this.scroll_pos(), n = Math.abs(r - e), this.scroll_inner.animate({ scrollLeft: e }, n / 2) }, t.prototype.scroll_pos = function () { return this.scroll_inner[0].scrollLeft }, t.prototype.max_scroll = function () { return this.scroll_inner[0].scrollWidth - this.scroll_outer.innerWidth() }, t.prototype.update_scrollbar = function () { var e, r, n, i; if (this.have_scrollbar) return n = this.scroll_outer.innerWidth(), r = this.scroll_inner[0].scrollWidth, e = r - n > this.edge_threshold, this.el.toggleClass("no_scrollbar", !e), e ? (i = this.scroll_pos(), this.scrollbar_inner.css({ width: 100 * n / r + "%", left: 100 * i / r + "%" }), this.unit_scroll = r / this.scroll_outer.width(), this.el.toggleClass("on_left", i <= this.edge_threshold), this.el.toggleClass("on_right", i >= this.max_scroll() - this.edge_threshold)) : this.el.removeClass("on_left on_right") }, t }(), I.ContentWarning = function () { function t(e, r) { this.opts = r, this.el = $(e), this.setup_forms() } return t.prototype.setup_forms = function () { var e; return e = this.el.find("form"), e.remote_submit(function (r) { return function (n) { if (n.errors) { e.set_form_errors(n.errors); return } return r.el.addClass("hidden"), setTimeout(function () { return r.el.remove() }, 300), e.set_form_errors([]) } }(this)) }, t }(); var Xe = function (t, e, r) { var n, i, o, a, s, u, l, c, p; for (e == null && (e = null), r == null && (r = !0), typeof t == "number" && (t = H.duration(t)), l = [["y", "years", "a year"], ["m", "months", "a month"], ["d", "days", "a day"], ["h", "hours", "an hour"], ["m", "minutes", "a minute"], ["s", "seconds", "a second"]], s = [], i = 0, a = l.length; i < a && (u = l[i], !(e && s.length === e)); i++)o = u[0], n = u[1], c = u[2], p = t[n](), p > 0 && (p > 1 ? n === "seconds" && r ? s.push("a few seconds") : s.push(p + " " + n) : s.push(c)); return s.length > 1 && (s[s.length - 1] = "and " + s[s.length - 1]), s.join(", ") }, Qe = function (t, e) { return function () { return t.apply(e, arguments) } }, Ze = function (t, e) { for (var r in e) et.call(e, r) && (t[r] = e[r]); function n() { this.constructor = t } return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t }, et = {}.hasOwnProperty; I.Countdown = function () { t.prototype.max_blocks = 4; function t(e, r, n) { this.date = r, this.opts = n != null ? n : {}, this.opts.max_blocks && (this.max_blocks = this.opts.max_blocks), this.el = $(e), this.update_countdown(), window.setInterval(function (i) { return function () { return i.update_countdown() } }(this), 1e3) } return t.prototype.update_countdown = function () { var e, r, n, i, o, a, s, u, l, c, p, h, v, y, w, k, x, S; for (p = ["years", "months", "days", "hours", "minutes", "seconds"], e = H.duration(ve(this.date) - new Date), r = !0, x = function () { var C, f, d; for (d = [], C = 0, f = p.length; C < f; C++)l = p[C], S = e[l](), !(S === 0 && r) && (S > 0 && (r = !1), d.push([l, S])); return d }(), x = x.slice(0, this.max_blocks), v = {}, n = 0, s = x.length; n < s; n++)h = x[n], l = h[0], k = h[1], v[l] = k; for (y = [], i = 0, u = p.length; i < u; i++)l = p[i], c = this.el.find("[data-name='" + l + "']"), S = v[l] || 0, w = v[l] == null, w || (o = c.find(".block_label"), a = o.text(), o.text(a.replace(/s$/, "") + (S === 1 ? "" : "s"))), y.push(c.toggleClass("hidden", w).find(".block_value").text(S)); return y }, t }(), I.TimestampCountdown = function (t) { Ze(e, t); function e() { return this.update_countdown = Qe(this.update_countdown, this), e.__super__.constructor.apply(this, arguments) } return e.prototype.update_countdown = function () { var r; return r = ve(this.date) - new Date, r < 0 && (r = -r), this.el.text(Xe(r, 1, !1)) }, e }(I.Countdown), $.fn.draggable = function (t) { var e, r, n, i, o, a, s, u; return t == null && (t = {}), u = "ontouchstart" in document, t.mobile === !1 && (u = !1), e = $(document.body), o = $("html"), a = 0, s = 0, i = function (l) { return function (c) { return e.removeClass("dragging"), l.removeClass("dragging"), o.off("mousemove touchmove", r), typeof t.stop == "function" ? t.stop() : void 0 } }(this), r = function (l) { return function (c, p, h) { var v, y; return v = p - a, y = h - s, a += v, s += y, typeof t.move == "function" ? t.move(v, y) : void 0 } }(this), n = function (l) { return function (c, p, h) { if (!e.is(".dragging") && !(typeof t.skip_drag == "function" && t.skip_drag(c))) return e.addClass("dragging"), l.addClass("dragging"), a = p, s = h, typeof t.start == "function" && t.start(), !0 } }(this), u ? this.on("touchstart", function (l) { return function (c) { var p, h, v; p = c.originalEvent.targetTouches[0], h = p.pageX, v = p.pageY, n(c, h, v) && (o.one("touchend", i), r = function (y) { return function (w) { var k; return k = w.originalEvent.targetTouches[0], h = k.pageX, v = k.pageY, y(w, h, v) } }(r), o.on("touchmove", r)) } }(this)) : this.on("mousedown", function (l) { return function (c) { if (n(c, c.pageX, c.pageY)) return o.one("mouseup", i), r = function (p) { return function (h) { return p(h, h.pageX, h.pageY) } }(r), o.on("mousemove", r) } }(this)) }; var tt = function (t, e) { for (var r in e) rt.call(e, r) && (t[r] = e[r]); function n() { this.constructor = t } return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t }, rt = {}.hasOwnProperty; I.FeedbackLightbox = function (t) { tt(e, t); function e() { return e.__super__.constructor.apply(this, arguments) } return e.prototype.init = function () { return this.el.find("form").remote_submit(function (r) { return function (n) { if (n.errors) { alert(n.errors.join(", ")); return } return r.el.addClass("is_complete") } }(this)) }, e }(I.Lightbox), I.FeedbackWidget = function () { function t(e) { this.el = $(e), this.el.on("click", function (r) { return function (n) { var i; return i = $(n.target).data("url") + "?" + $.param({ url: window.location.href }), I.Lightbox.open_remote(i, I.FeedbackLightbox) } }(this)) } return t }(); var xt = I.FilterPickers = function () { t.prototype.label_padding = 10; function t(e, r) { var n, i; this.opts = r != null ? r : {}, this.el = $(e), n = this.el.find(".filter_picker_widget"), this.opts.label_padding && (this.label_padding = this.opts.label_padding), i = function (o) { return function () { return n.removeClass("open popup_visible").find(".filter_options").css({ marginTop: "" }) } }(this), $(window).on("click", function (o) { return function (a) { if (!$(a.target).closest(".filter_picker_widget").length) return i() } }(this)), this.el.on("i:close_filter_pickers", i), this.el.on("click", ".filter_picker_widget .filter_value", function (o) { return function (a) { var s, u, l; return a.preventDefault(), u = $(a.currentTarget).closest(".filter_picker_widget"), u.trigger("i:track_link"), n.not(u).removeClass("open popup_visible"), u.toggleClass("open"), s = u.find(".filter_value").height(), u.find(".filter_options").css({ marginTop: s + o.label_padding * 2, minWidth: u.width() + 30 + "px" }), l = $(window).width() - u.position().left + u.width(), u.toggleClass("popup_left", l < 200), _.defer(function () { return u.toggleClass("popup_visible", u.is(".open")) }) } }(this)) } return t }(), z = window.I; z.Lightbox || console.warn("I.Lightbox is being depended on but is missing from the page"); var ie = z.Lightbox, nt = function (t, e) { for (var r in e) it.call(e, r) && (t[r] = e[r]); function n() { this.constructor = t } return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t }, it = {}.hasOwnProperty, ot = function (t) { nt(e, t); function e() { return e.__super__.constructor.apply(this, arguments) } return e.prototype.init = function (r) { return this.el.dispatch("click", { tab_btn: function (n) { return function (i) { var o; return o = i.data("tab"), n.el.find(".tab_content").hide().filter("[data-tab=" + o + "]").show(), n.el.find(".tab_btn").removeClass("selected").filter(i).addClass("selected") } }(this), pick_image_btn: function (n) { return function (i) { return typeof r == "function" ? r(i.data("url")) : void 0 } }(this), upload_image_btn: function (n) { return function (i) { return z.upload_image({ url: z.root_url("dashboard/upload-image"), thumb_size: "original" }).progress(function () { if (!i.prop("disabled")) return i.prop("disabled", !0).addClass("disabled"), i.data("original_text", i.text()), i.text("Uploading...") }).fail(function () { return i.prop("disabled", !1).removeClass("disabled"), i.text(i.data("original_text")) }).done(function (o) { var a, s; return i.prop("disabled", !1).removeClass("disabled"), i.text(i.data("original_text")), o.success ? typeof r == "function" ? r(o.upload.thumb_url) : void 0 : (a = ((s = o.errors) != null ? s[0] : void 0) || "Image upload failed", z.flash(a, "error")) }) } }(this) }) }, e }(ie), be = null, st = { plugins: ["source", "table", "alignment", "video", "addimage"], toolbarFixed: !1, buttons: ["format", "bold", "italic", "deleted", "lists", "link"], minHeight: 250, linkSize: 80 }, at = function (t, e) { var r, n; if (e == null && (e = {}), !window.location.href.match(/\bredactor=0\b/) && !z.in_test) { if (!m.fn.redactor) { console.warn("tried to create redactor text element without redactor on page", t[0]); return } e = m.extend({}, st, e), e.source === !1 && (delete e.source, e.plugins = function () { var i, o, a, s; for (a = e.plugins, s = [], i = 0, o = a.length; i < o; i++)n = a[i], n !== "source" && s.push(n); return s }()), t.closest(".lightbox_widget").exists() && e.plugins && (e.plugins = function () { var i, o, a, s; if (n !== "addimage") { for (a = e.plugins, s = [], i = 0, o = a.length; i < o; i++)n = a[i], s.push(n); return s } }()); try { return t.redactor(e) } catch (i) { return r = i, z.event("error", "redactor", "invalid_content"), t.parent().replaceWith(t).end().val("").redactor(e) } } }; m.Redactor ? be = m.Redactor : z.libs.redactor.done(function () { return be = m.Redactor, m.Redactor.prototype.addimage = function () { return { langs: { en: {} }, init: function () { var t; return t = this.button.addAfter("image", "image", "Add image"), this.button.setIcon(t, '<i class="re-icon-image"></i>'), this.button.addCallback(t, this.addimage.show) }, show: function () { return ie.open_remote(z.root_url("dashboard/upload-image"), ot, function (t) { return function (e) { var r; return z.Lightbox.close(), r = m("<img>").attr("src", e)[0].outerHTML, t.placeholder.hide(), t.buffer.set(), t.insert.html(r) } }(this)) } } } }); var ut = function (t, e) { for (var r in e) lt.call(e, r) && (t[r] = e[r]); function n() { this.constructor = t } return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t }, lt = {}.hasOwnProperty, xe = z.CollectionLightbox = function (t) { ut(e, t); function e() { return e.__super__.constructor.apply(this, arguments) } return e.prototype.init = function () { var r; return z.has_follow_button(this.el), z.event2("view add to collection lightbox"), this.el.find("input[type='radio']:first").prop("checked", !0), this.el.on("click change", ".collection_option", function (n) { return function (i) { var o; return o = $(i.currentTarget), o.find("input[type='radio']").prop("checked", !0) } }(this)), r = this.el.find("form").remote_submit(function (n) { return function (i) { if (i.errors) { if (z.add_recaptcha_if_necessary(r, i.errors)) return; r.set_form_errors(i.errors); return } return n.el.addClass("is_complete"), n.el.find(".after_submit .collection_name").text(i.title).attr("href", i.url) } }(this)), this.with_redactor(function (n) { return function () { return at(n.el.find("textarea"), { minHeight: 40, source: !1, buttons: ["bold", "italic", "deleted", "lists", "link"] }) } }(this)), this.with_selectize(function (n) { return function () { return n.el.find("select.collection_input").selectize() } }(this)) }, e }(ie), ct = function (t, e) { return function () { return t.apply(e, arguments) } }, ft = I.GamePopups = function () { t.prototype.trigger_selector = ".game_thumb", t.prototype.popup_selector = ".popup_details", t.prototype.hover_delay = 250, t.prototype.close_timeout = 200, t.prototype.x_offset = 0; function t(e, r) { var n; r == null && (r = {}), this.deferred_for_el = ct(this.deferred_for_el, this), !I.is_mobile() && (this.el = m(e), m.extend(this, r), n = m(document.body), this.el.on("mouseenter mouseleave", this.trigger_selector, function (i) { return function (o) { if (e = m(o.currentTarget), !e.closest(".jam_cell").length && !e.closest(".disable_hover").length) return o.type === "mouseenter" ? i.enter(e) : i.leave(e) } }(this)), n.on("i:hide_popups", function (i) { return function (o, a) { return i.close_popup() } }(this)), n.on("i:hide_other_popups", function (i) { return function (o, a) { if (a !== i) return i.close_popup() } }(this))) } return t.prototype.deferred_for_el = function (e) { var r, n, i; if (r = e.data("i:popup_defer"), !r) { if (n = e.closest("[data-game_id]").data("game_id"), r = m.Deferred(), e.data("i:popup_defer", r), !n) return; i = I.subdomain ? "/-/game/popup/" + n : "/game/popup/" + n, m.get(i, function (o) { return function (a) { var s; if (!(_.isObject(a) && a.errors)) return s = m(a), s.data("object_id", n), I.tracked_links(s, "popups", I.page_name(), "click"), s.find("a").on("click", function () { var u; if (u = s.data("trigger_el")) return u.trigger("i:track_link") }), r.resolve(s) } }(this)) } return r }, t.prototype.enter = function (e) { var r, n; return e.data("i:inside", !0), n = _.debounce(function (i) { return function () { if (e.data("i:inside")) return i.deferred_for_el(e).then(function (o) { return i.show_popup(e, o) }) } }(this), this.hover_delay), r = _.debounce(function (i) { return function () { var o; if (e.data("i:inside")) return o = new Date, i.deferred_for_el(e) } }(this), this.hover_delay / 2), e.on("mousemove.hover_manager", function () { return n(), r() }) }, t.prototype.leave = function (e) { return e.data("i:inside", !1), e.off("mousemove.hover_manager") }, t.prototype.show_popup = function (e, r) { var n, i, o, a, s, u, l, c; if (typeof (n = document.body).contains == "function" && n.contains(e[0]) && this.current_popup !== r) { for (this.el.trigger("i:hide_other_popups", [this]), (u = this.current_popup) != null && u.stop().remove(), this.current_popup = r.css({ left: "0px", top: "0px" }).removeClass("visible"), c = r.find(".popup_screenshot").removeClass("visible"), m(document.body).append(r), this.position_popup(e, r), _.defer(function (p) { return function () { return r.addClass("visible") } }(this)), r.data("trigger_el", e), i = function (p) { return function (h) { return setTimeout(function () { return h.addClass("visible") }, o * 100) } }(this), o = a = 0, s = c.length; a < s; o = ++a)l = c[o], i(m(l)); return r.hide().css({ opacity: "" }).fadeIn("fast"), this.watch_for_popup_close() } }, t.prototype.watch_for_popup_close = function () { var e, r; return r = this.trigger_selector + ", " + this.popup_selector, e = null, m(document.body).on("click.hover_manager", function (n) { return function (i) { var o; if (o = m(i.target), !o.closest(r).length) return n.close_popup() } }(this)), m(window).on("mousemove.hover_manager", _.throttle(function (n) { return function (i) { var o; if (o = m(i.target).closest(r), o.length) { e && (window.clearTimeout(e), e = null); return } if (!e) return e = window.setTimeout(function () { return n.close_popup() }, n.close_timeout) } }(this), 50)) }, t.prototype.position_popup = function (e, r) { var n, i, o, a, s, u, l; return o = e.offset(), l = r.outerWidth(!0), n = r.outerHeight(!0), r.removeClass("on_right"), a = e.outerHeight(), s = e.outerWidth(), u = o.top + (a - n) / 2, i = o.left - l, i < 0 ? (i = o.left + s, i += this.x_offset, r.addClass("on_right")) : i -= this.x_offset, r.css({ top: Math.floor(u) + "px", left: Math.floor(i) + "px" }) }, t.prototype.close_popup = function () { var e; return m(window).off("mousemove.hover_manager"), m(document.body).off("click.hover_manager"), (e = this.current_popup) != null && e.stop(!0).remove(), this.current_popup = null }, t }(), kt = I.GamePopup = function () { function t(e) { this.el = m(e), this.el.dispatch("click", { watch_trailer_btn: function (r) { return I.event("grid", I.page_name(), "watch_trailer"), I.Lightbox.open_remote(r.data("lightbox_url")) } }) } return t }(), It = I.WatchTrailerLightbox = function () { function t(e) { this.el = m(e), this.el.dispatch("click", { add_to_collection_btn: function (r) { return function (n) { return I.event("grid", "trailer", "add_to_collection"), I.current_user ? I.Lightbox.open_remote(n.attr("href"), xe) : "continue" } }(this) }) } return t }(), G = window._, oe = [].slice, se = z.ConversionTracker || (z.ConversionTracker = function () { function t() { } return t.types = { impression: 1, click: 2, purchase: 3, download: 4, join: 5 }, t.buffer = [], t.find_click = function (e) { var r, n, i, o, a, s; for (s = new RegExp(":" + e + "$"), r = this.get_cookie(), i = 0, a = r.length; i < a; i++)if (o = r[i], n = G.isArray(o) ? o[0] : o, n.match(s)) return o }, t.strip_click = function (e) { var r, n, i, o, a, s; return a = new RegExp(":" + e + "$"), r = this.get_cookie(), s = 0, o = function () { var u, l, c; for (c = [], u = 0, l = r.length; u < l; u++) { if (i = r[u], n = G.isArray(i) ? i[0] : i, n.match(a)) { s += 1; continue } c.push(i) } return c }(), o.length === r.length ? 0 : (this.write_cookie(o), s) }, t.after_click_action = function (e, r) { var n, i, o, a; if (n = this.find_click(r), !!n) return a = null, o = G.isArray(n) ? (a = n[1], n[0]) : n, i = o.replace(/^\d+/, this.types[e]), this.strip_click(r), this.push(i, a), !0 }, t.download = function (e) { return this.after_click_action("download", e) }, t.purchase = function (e) { return this.after_click_action("purchase", e) }, t.join = function (e) { return this.after_click_action("join", e) }, t.click = function (e) { var r, n, i, o, a, s; i = this.types.click + ":" + e, o = (s = this.get_active_splits()) ? [i, s] : i, this.push(i); try { for (n = function () { var u, l, c, p; for (c = this.get_cookie(), p = [], u = 0, l = c.length; u < l; u++)r = c[u], a = G.isArray(r) ? r[0] : r, a !== i && p.push(r); return p }.call(this), n.push(o); n.length > 100;)n.shift(); return this.write_cookie(n), !0 } catch (u) { } }, t.write_cookie = function (e) { return z.set_cookie("itchio_ca", JSON.stringify(e), { expires: 1 }) }, t.get_cookie = function () { var e; if (e = window.Cookies.get("itchio_ca"), e) try { return JSON.parse(e) || [] } catch (r) { try { return JSON.parse(decodeURIComponent(e)) || [] } catch (n) { return [] } } else return [] }, t.flush_later = function () { return this.flush_later = G.throttle(this.flush_now, 2e3, { leading: !1 }), $(window).on("beforeunload", function (e) { return function () { e.flush_now() } }(this)), this.flush_later() }, t.encode_buffer = function (e) { var r, n, i, o, a, s, u, l, c, p, h, v, y, w, k; for (e == null && (e = oe.call(this.buffer)), e.sort(), h = [], u = null, s = null, a = null, i = 0, l = e.length; i < l; i++)n = e[i], y = n.match(/^(\d+):(\d+):(\d+):(\d+)$/), r = y[0], k = y[1], w = y[2], p = y[3], c = y[4], k && (k !== u && (h.push("t" + k), u = k), w !== s && (h.push("s" + w), s = w), p !== a && (h.push("o" + p), a = p), o = (+c).toString(36), v = String.fromCharCode("A".charCodeAt(0) + o.length), h.push("" + v + o)); return h.join("") }, t.get_active_splits = function () { return z.active_splits }, t.flush_url = function (e) { var r, n, i; return i = this.encode_buffer(), r = [{ name: "x", value: i }], (n = e || this.get_active_splits()) && r.push({ name: "s", value: n.join(",") }), z.root_url("ca.gif") + "?" + $.param(r) }, t.flush_now_beacon = function (e) { var r; if (navigator.sendBeacon == null) return this.flush_now(e); if (this.buffer.length) if (z.in_dev && console.debug.apply(console, ["ca(beacon)"].concat(oe.call(G.compact([this.buffer, e])))), r = this.flush_url(e), navigator.sendBeacon(r)) this.buffer = []; else return this.flush_now(); return $.when() }, t.flush_now = function (e) { var r; return this.buffer.length ? (z.in_dev && console.debug.apply(console, ["ca"].concat(oe.call(G.compact([this.buffer, e])))), r = this.flush_url(e), this.buffer = [], $.Deferred(function (n) { return function (i) { var o, a; return a = new Image, a.src = r, o = function () { return i.resolve() }, a.onerror = o, a.onload = o } }(this))) : $.when() }, t.push = function (e, r) { var n; return this.buffer = function () { var i, o, a, s; for (a = this.buffer, s = [], i = 0, o = a.length; i < o; i++)n = a[i], n !== e && s.push(n); return s }.call(this), this.buffer.push(e), this.buffer.length > 50 || r ? this.flush_now(r) : this.flush_later() }, t }()), ke, Ie, X = function (t, e) { return function () { return t.apply(e, arguments) } }; ke = 0, Ie = function () { return "game_grid_" + ke++ }, I.GameGridSizer = function () {
        t.prototype.container_selector = !1, t.prototype.expected_size = 315, t.prototype.aspect_ratio = 315 / 250, t.prototype.cell_margin = 10, t.prototype.min_columns = 1, t.initialize = _.once(function () { var e, r, n; return e = m(document.body), r = _.debounce(function () { return e.addClass("disable_hover") }, 200, !0), n = _.debounce(function () { return e.removeClass("disable_hover") }, 200), m(window).on("scroll resize", function () { r(), n() }) }); function t(e) { e == null && (e = {}), m.extend(this, e), this.size_callbacks = [], this.constructor.initialize(), m(window).on("resize", _.debounce(function (r) { return function () { return r.resize_cells() } }(this), 200)), this.resize_cells(), I.in_test || _.defer(function (r) { return function () { return r.resize_cells() } }(this)) } return t.prototype.get_cell_margin = function () { return typeof this.cell_margin == "function" ? this.cell_margin() : this.cell_margin }, t.prototype.get_expected_size = function () { return typeof this.expected_size == "function" ? this.expected_size() : this.expected_size }, t.prototype.on_size = function (e) { return this.size_callbacks.push(e) }, t.prototype.available_width = function () { var e, r, n, i; return this.el ? (e = (i = this.el[0]) != null ? i.getBoundingClientRect().width : void 0, n = e - Math.floor(e), r = Math.floor(this.el.width()), n > 0 && (r -= 1), r) : m(window).width() }, t.prototype.resize_cells = function () {
            var e, r, n, i, o, a, s, u, l, c, p, h, v, y; for (i = this.get_expected_size(), r = this.get_cell_margin(), h = i + r, c = this.available_width() + r, l = c / h, p = Math.ceil(l), p < this.min_columns && (p = this.min_columns), u = c / p - r, s = u / this.aspect_ratio, u = Math.floor(u), s = Math.floor(s), this.cells_per_row = p, this._style && (this._style.remove(), this._style = null), n = "", this.container_selector && (n += this.container_selector + ` {
  --itchio_grid_gap: `+ r + `px;
  --itchio_grid_cell_width: `+ u + `px;
  --itchio_grid_cell_columns: `+ p + `;
  grid-template-columns: repeat(`+ p + ", " + u + `px);
}`), n !== "" && (this._style = m("<style itchio-grid-sizer type='text/css'>" + n + "</style>").appendTo(m("head"))), v = this.size_callbacks, y = [], o = 0, a = v.length; o < a; o++)e = v[o], y.push(e(this, u, s)); return y
        }, t
    }(), I.GameCells = function () { function t(e) { this.setup_game_tools = X(this.setup_game_tools, this), this.el = m(e), this.setup_game_tools(), this.setup_gifs() } return t.prototype.setup_game_tools = function () { return this.el.dispatch("click", { add_to_collection_btn: function (e) { return function (r) { return I.event("grid", I.page_name(), "add_to_collection"), I.current_user ? Je.open_remote(r.attr("href"), xe) : "continue" } }(this) }) }, t.prototype.setup_gifs = function () { return this.el.on("mouseenter", ".game_cell", function (e) { return function (r) { var n, i; if (n = m(r.currentTarget), !n.data("grid_hovered") && (n.data("grid_hovered", !0), i = n.find(".gif_overlay"), !!i.length)) return i.css("background-image", "url(" + i.data("gif") + ")") } }(this)) }, t }(), I.GameGrid = function () { function t(e, r) { var n, i, o, a, s; if (r == null && (r = {}), this.refresh_images = X(this.refresh_images, this), this.add_image_loading = X(this.add_image_loading, this), this.setup_conversion_tracking = X(this.setup_conversion_tracking, this), this.el = m(e), m.extend(this, r), this.setup_lazy_images(), this.show_popups !== !1 && new ft(this.el), new I.GameCells(this.el), !this.sizer && this.sizer !== !1) { for (n = ["container_selector", "expected_size", "min_columns", "cell_margin"], this.el[0] && !this.el[0].id && (this.el[0].id = Ie()), s = { el: this.el, container_selector: "#" + this.el[0].id }, o = 0, a = n.length; o < a; o++)i = n[o], i in r && (s[i] = r[i]); this.sizer = new I.GameGridSizer(s), this.sizer.on_size(function (u) { return function () { return u.el.trigger("i:grid_resize"), u.el.lazy_images() } }(this)) } } return t.prototype.setup_lazy_images = function () { return _.defer(function (e) { return function () { return e.add_image_loading() } }(this)) }, t.prototype.setup_conversion_tracking = function (e) { return this.el.on("i:impression", function (r) { return function (n) { var i, o; if (i = m(n.target).closest("[data-game_id]"), o = i.data("game_id"), !!o) return se.push("1:" + e + ":1:" + o) } }(this)), this.el.on("i:delegate_tracking", function (r) { return function (n, i) { var o; if (o = m(n.target).closest("[data-game_id]").data("game_id"), !!o) return se.click(e + ":1:" + o), i(se.flush_now()) } }(this)) }, t.prototype.add_image_loading = function () { return this.el.lazy_images({ show_item: function (e) { return function (r) { return r.trigger("i:impression"), r.find(".image_loading").addBack(".image_loading").removeClass("image_loading") } }(this) }) }, t.prototype.refresh_images = function () { var e; return typeof (e = this.el.data("lazy_images")) == "function" ? e() : void 0 }, t }(); var ae = function (t, e) { return function () { return t.apply(e, arguments) } }, dt = z.HoverManager = function () { t.prototype.default_opts = { timeout: 1e3, enter_timeout: 150, fade_timeout: 400, show: function () { }, hide: function () { }, after_fade: function () { } }; function t(e) { this._clear_enter_timeout = ae(this._clear_enter_timeout, this), this._clear_fade_timeout = ae(this._clear_fade_timeout, this), this._clear_leave_timeout = ae(this._clear_leave_timeout, this), this.opts = $.extend({}, this.default_opts, e), this.open = !1 } return t.prototype.enter = function () { if (!this.enter_timeout) return this._clear_leave_timeout(), this._clear_fade_timeout(), this.enter_timeout = window.setTimeout(function (e) { return function () { var r; return delete e.enter_timeout, e.open || typeof (r = e.opts).show == "function" && r.show(), e.open = !0 } }(this), this.opts.enter_timeout) }, t.prototype.leave = function () { if (!this.leave_timeout) return this._clear_enter_timeout(), this.leave_timeout = window.setTimeout(function (e) { return function () { return delete e.leave_timeout, e.hide() } }(this), this.opts.timeout) }, t.prototype.hide = function () { var e; return this._clear_enter_timeout(), this._clear_leave_timeout(), this.open && typeof (e = this.opts).hide == "function" && e.hide(), this.open = !1, this.hiding = !0, this.fade_timeout = window.setTimeout(function (r) { return function () { var n; return typeof (n = r.opts).after_fade == "function" && n.after_fade(), r.hiding = !1 } }(this), this.opts.fade_timeout) }, t.prototype.show = function () { var e; return typeof (e = this.opts).show == "function" ? e.show() : void 0 }, t.prototype._clear_leave_timeout = function () { if (this.leave_timeout) return window.clearTimeout(this.leave_timeout), delete this.leave_timeout }, t.prototype._clear_fade_timeout = function () { if (this.fade_timeout) return window.clearTimeout(this.fade_timeout), delete this.fade_timeout }, t.prototype._clear_enter_timeout = function () { if (this.enter_timeout) return window.clearTimeout(this.enter_timeout), delete this.enter_timeout }, t }(), pt = function (t, e) { return function () { return t.apply(e, arguments) } }; I.Header = function () { t.prototype.track_category = "header"; function t(e) { this.setup_browse_menu = pt(this.setup_browse_menu, this), this.el = m(e), I.tracked_links(this.el, this.track_category, "click"), this.el.on("click", ".menu_tick", function (r) { return function (n) { var i, o, a; if (!m(n.target).closest(".drop_menu").length) return a = m(n.currentTarget), o = a.closest(".drop_menu_wrap").toggleClass("open"), i = m(document.body), o.is(".open") ? (a.trigger("i:track_link"), i.on("click.drop_menu", function (s) { if (!m(s.target).closest(o).length) return o.removeClass("open"), i.off("click.drop_menu") })) : i.off("click.drop_menu") } }(this)), this.setup_browse_menu() } return t.prototype.setup_browse_menu = function () { var e; return e = this.el.find(".browse_btn"), this.browse_menu = new dt({ timeout: 750, enter_timeout: 100, show: function (r) { return function () { return r.el.addClass("hover_menu_open"), e.addClass("open"), setTimeout(function () { return r.el.addClass("hover_menu_visible") }, 0) } }(this), hide: function (r) { return function () { return e.removeClass("open"), r.el.removeClass("hover_menu_visible") } }(this), after_fade: function (r) { return function () { return r.el.removeClass("hover_menu_open") } }(this) }), m(document.body).on("click", function (r) { return function (n) { var i; i = m(n.target).closest(".browse_btn, .header_dropdown"), !i.length && r.browse_menu.hide() } }(this)), this.el.on("mouseenter mouseleave", ".browse_btn, .header_dropdown", function (r) { return function (n) { return n.type === "mouseenter" ? r.browse_menu.enter() : r.browse_menu.leave() } }(this)) }, t }(); var Q, ue, B, $e, le, ce, Z, Ce, U, Re = [].slice, Te = {}.hasOwnProperty; U = {}, Z = {}, Q = "en", B = (Ce = window.itchio_locale) != null ? Ce : Q, $e = window.requestAnimationFrame || _.defer, le = function (t, e, r) { var n, i, o, a, s, u, l; for (o = 0, a = e.length; o < a; o++)if (s = e[o], _.isString(s)) t.push(s); else if (s[0] === "v") l = r[s[1]], l || console.warn("i18n: failed to find value for variable " + s[1]), t.push(l); else if (s[0] === "t") { if (i = r[s[1]], typeof i != "function") throw new Error("i18n: tried to interpolate tag without function: " + s[1]); n = s[2], u = [], le(u, n || [], r), t.push(i(u.join(""))) } else throw new Error("i18n: unknown interpolation node: " + JSON.stringify(s)); return t }, ce = function (t, e) { var r, n, i, o; return _.isString(t) ? t : (n = function () { var a, s, u; for (u = [], a = 0, s = t.length; a < s; a++)if (i = t[a], _.isString(i)) u.push(i); else if (i[0] === "v") o = e[i[1]], o || console.warn("i18n: failed to find value for variable " + i[1]), u.push(o); else if (i[0] === "t") { if (r = e[i[1]], typeof r != "function") throw new Error("i18n: tried to interpolate tag without function: " + i[1]); u.push(r(ce(i[2], e))) } else throw new Error("i18n: unknown interpolation node: " + JSON.stringify(i)); return u }(), n.length > 1 ? React.createElement.apply(React, [React.Fragment, {}].concat(Re.call(n))) : n.length === 0 ? null : n) }, ue = function () { t._cache = {}, t.for_locale = function (e) { var r; return (r = this._cache)[e] || (r[e] = new t(e)) }; function t(e) { this.locale = e, this.last_fetch = null, this.next_fetch = null } return t.prototype.fetch = function (e, r) { return this.next_fetch ? (this.next_fetch = this.next_fetch.concat(e), this.last_fetch) : (this.next_fetch = e, this.last_fetch = $.Deferred(function (n) { return function (i) { return $e(function () { var o, a; if (!window.itchio_translations_url) { console.error("missing translations url: itchio_translations_url"); return } return o = n.next_fetch, a = $.get(window.itchio_translations_url, { locale: n.locale, prefixes: n.next_fetch.join(",") }), n.next_fetch = null, a.done(function (s) { var u, l; for (u in s) Te.call(s, u) && (l = s[u], !r[u] && (r[u] = l)); return i.resolve() }) }) } }(this))) }, t }(), I.i18n = { Preloader: ue, get_translations: function () { return U }, get_cache: function () { return Z }, get_locale: function () { return B }, locale_is_english: function () { return B === "en" }, insert: function (t) { var e, r, n; r = []; for (e in t) Te.call(t, e) && (n = t[e], !U[e] && r.push(U[e] = n)); return r }, set_locale: function (t) { return B = t, U = {}, Z = {} }, render_string: function (t, e, r) { var n; if (_.isString(e)) return r && console.warn("i18n: provided variables to translation string with no interpolation: " + t), e; if (n = [], !r) throw new Error("i18n: tried to interpolate " + t + " without variables"); return le(n, e, r), n.join("") }, t: function (t, e) { return I.i18n.fetch_key(t).then(function (r) { return function (n) { return I.i18n.render_string(t, n, e) } }(this)) }, t_sync: function (t, e) { var r; if (r = I.i18n.fetch_key_sync(t), !r) throw new Error("i18n: failed to fetch key sync: " + t); return I.i18n.render_string(t, r, e) }, fetch_key_sync: function (t) { return B === "debug" ? "[[" + t + "]]" : U[t] }, fetch_key: function (t) { var e, r; if (B === "debug") return $.when("[[" + t + "]]"); if (e = t.split("."), e.pop(), !e.length) throw new Error("i18n: empty prefix"); return r = e.join("."), I.i18n.preload(r).then(function (n) { return function () { var i; if (i = U[t], i) return i; if (B === Q) throw new Error("i18n: failed to find key: " + t); return I.i18n.preload(r, Q).then(function () { if (i = U[t], !i) throw new Error("i18n: failed to find key: " + t); return i }) } }(this)) }, preload: function (t, e) { var r, n, i, o, a, s, u; if (e == null && (e = B), e !== "debug") { if (r = Z, _.isString(t) && (t = [t]), u = function () { var l, c, p; for (p = [], l = 0, c = t.length; l < c; l++)s = t[l], r[e] || (r[e] = {}), !r[e][s] && p.push(s); return p }(), n = function () { var l, c, p, h; for (h = [], l = 0, c = t.length; l < c; l++)s = t[l], ((p = r[e][s]) != null ? p.state() : void 0) === "pending" && h.push(r[e][s]); return h }(), !u.length) return $.when.apply($, n); for (i = ue.for_locale(e).fetch(u, U), o = 0, a = u.length; o < a; o++)s = u[o], r[e][s] || (r[e][s] = i); return n.length ? $.when.apply($, [i].concat(Re.call(n))) : i } }, react_class: function (t) { return createReactClass({ displayName: "i18n:" + t, getInitialState: function () { var e; return e = function () { var r; return (r = I.i18n.fetch_key_sync(t)) ? { text: r } : null }, e.isReactClassApproved = !0, e }(), componentWillUnmount: function () { return this.unmounted = !0 }, componentDidMount: function () { if (!(this.state && this.state.text)) return I.i18n.fetch_key(t).done(function (e) { return function (r) { if (!e.unmounted) return e.setState({ text: r }) } }(this)) }, render: function () { return this.state ? _.isString(this.state.text) ? this.state.text : ce(this.state.text, this.props) : "\u2026" } }) } }; var $t = he(_e()), D = window.React, Se = window.ReactDOM, Y = window.ReactDOMFactories, ht = window.ReactTransitionGroup, M = window.PropTypes, F = window.classNames, A = window.R; D || z.libs.react.done(function () { return D = window.React, Se = window.ReactDOM, Y = window.ReactDOMFactories, ht = window.ReactTransitionGroup, M = window.PropTypes, F = window.classNames, A = window.R }); var ee = null; z.libs.react.done(function () { var t, e; return t = Y, e = t.img, ee = function (r) { var n, i, o, a, s; return r == null && (r = {}), s = (i = r.width) != null ? i : 24, n = (o = r.height) != null ? o : s, D.createElement("svg", { className: "svgicon icon_close", strokeLinecap: "round", stroke: "currentColor", role: "img", version: "1.1", viewBox: "0 0 24 24", strokeWidth: (a = r.stroke_width) != null ? a : "2", width: s, height: n, strokeLinejoin: "round", "aria-hidden": !0, fill: "none" }, D.createElement("line", { x1: "18", y1: "6", x2: "6", y2: "18" }), D.createElement("line", { x1: "6", y1: "6", x2: "18", y2: "18" })) }, ee = D.createElement.bind(null, D.memo(ee)) }); var je = null, _t = null, gt = null; I.libs.react.done(function () { var t, e, r, n, i, o, a, s; return t = Y, e = t.a, i = t.div, r = t.button, a = t.label, o = t.h2, s = t.p, n = null, gt = function (u) { return u.promise ? (I.Lightbox.open_loading(), u.then(function (l) { return function (c) { return I.Lightbox.open(c) } }(this))) : I.Lightbox.open(u) }, je = A.component("Lightbox", { is_modal_dialog: function () { var u; return u = document.getElementById("lightbox_container"), u != null ? u.contains(this.container_ref.current) : void 0 }, getInitialState: function () { return {} }, componentDidMount: function () { if (this.is_modal_dialog()) return n ? console.warn("A dialog already has the focus trap") : (this.detect_focus = function (u) { return function (l) { var c; if (c = u.container_ref.current, c && "contains" in c && !(c === l.target || c.contains(l.target))) return c.focus() } }(this), $(document.body).on("focusin", this.detect_focus), n = this), this.setState({ previously_focused: document.activeElement, is_modal_dialog: !0 }, function () { return _.defer(function (u) { return function () { var l; return (l = u.container_ref.current) != null ? l.focus() : void 0 } }(this)) }) }, componentWillUnmount: function () { var u; return this.detect_focus && ($(document.body).off("focusin", this.detect_focus), n = null, delete this.detect_focus), (u = this.state.previously_focused) != null ? u.focus() : void 0 }, close: function () { return I.Lightbox.close() }, render: function () { return i({ className: classNames("lightbox", this.props.className), style: this.props.style, role: this.state.is_modal_dialog ? "dialog" : void 0, "aria-modal": this.state.is_modal_dialog ? "true" : void 0, tabIndex: this.state.is_modal_dialog ? -1 : void 0, ref: this.container_ref || (this.container_ref = React.createRef()) }, this.props.close !== !1 ? r({ className: "close_button", type: "button", "aria-label": "Close Dialog" }, ee({ width: 18 })) : void 0, this.props.children) } }), _t = A.component("ErrorLightbox", { propTypes: { title: M.string, errors: M.array.isRequired }, render: function () { return A.Lightbox({ className: classNames(this.enclosing_class_name(), "compact") }, o({}, this.props.title || this.tt("misc.lightboxes.error_title")), A.Forms.FormErrors({ title: !1, errors: this.props.errors }), s({ className: "buttons" }, r({ className: "button", type: "button", onClick: function (u) { return function () { return I.Lightbox.close() } }(this) }, "Close"))) } }) }); var ze; ze = function (t) { var e, r, n, i, o, a, s, u, l, c, p, h, v, y, w; return l = ReactDOMFactories.table, h = ReactDOMFactories.thead, c = ReactDOMFactories.tbody, w = ReactDOMFactories.tr, p = ReactDOMFactories.td, e = ReactDOMFactories.abbr, n = ReactDOMFactories.details, u = ReactDOMFactories.summary, i = ReactDOMFactories.div, o = ReactDOMFactories.h2, r = ReactDOMFactories.code, s = ReactDOMFactories.pre, a = ReactDOMFactories.p, v = t.query_log.length, y = t.query_log.reduce(function (k, x) { return k + x[1] }, 0), je({ className: "compact perf_query_log_widget", style: { width: "100%", maxWidth: "800px" } }, o({}, "Query log"), a({ style: { margin: "0 10px" } }, "Queries: ", r({}, v), ", Time: ", r({}, (y * 1e3).toFixed(2) + "ms")), i({ style: { padding: "10px" } }, l({ className: "nice_table", style: { width: "100%" } }, h({}, w({}, p({}, "Query"), p({}, "Timing"))), c({}, t.query_log.map(function (k) { return function (x, S) { var C, f, d; return C = x[0], d = x[1], f = d * 1e3, w({ key: S }, p({}, n({}, u({}, r({ style: { whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis", display: "inline-block", maxWidth: "600px" } }, C)), s({ style: { whiteSpace: "pre-wrap" } }, C))), p({}, r({ style: { fontWeight: f > 10 ? "bold" : void 0, color: f > 100 ? "white" : f > 50 ? "red" : void 0, backgroundColor: f > 100 ? "red" : void 0 } }, f.toFixed(2) + "ms"))) } }(this)))))) }, I.PerfPanel = function () {
        function t(e) {
            var r; e.layout_time || (e.layout_time = 0), e.view_time || (e.view_time = 0), e.db_time || (e.db_time = 0), e.db_count || (e.db_count = 0), r = _.template(`<div class="perf_panel">
  <div class="stat_row">
    <strong>Queries:</strong> {{ db_count }}
  </div>

  <div class="stat_row">
    <strong>Query time:</strong> {{ Math.floor(db_time * 1000) }}ms
  </div>

  <div class="stat_row">
    <strong>View time:</strong> {{ Math.floor((view_time + layout_time) * 1000) }}ms
  </div>

  <div class="stat_row">
    <strong>Rest:</strong> {{ Math.floor((total_time - (view_time + layout_time + db_time)) * 1000) }}ms
  </div>

</div>`), this.data = e, this.el = $(r(e)).appendTo(document.body), this.el.on("click", function (n) { return function () { return n.render_queries() } }(this))
        } return t.prototype.render_queries = function () { var e, r, n; if (this.data.query_log) return r = function () { var i, o, a, s, u; for (a = this.data.query_log, u = [], i = 0, o = a.length; i < o; i++)s = a[i], e = s[0], n = s[1], u.push({ query: e, time: n * 1e3 }); return u }.call(this), console.table(r), I.add_react().done(function (i) { return function () { if (typeof R != "undefined" && R !== null && R.Lightbox) return I.Lightbox.open(ze({ query_log: i.data.query_log })) } }(this)) }, t
    }(), I.SaleList = function () { function t(e) { this.el = $(e), this.el.lazy_images({}) } return t }(); var te, Me, V = function (t, e) { return function () { return t.apply(e, arguments) } }, De = function (t, e) { for (var r in e) mt.call(e, r) && (t[r] = e[r]); function n() { this.constructor = t } return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t }, mt = {}.hasOwnProperty, Le = function (t) { return t.then(null, function (e) { return $.Deferred().reject({ errors: ["Server error (" + e.status + ")", "Please contact support if the error persists"] }) }) }; I.prepare_upload = function (t, e) { return $.when(e).then(function (r) { return Le($.ajax({ url: t + "/upload/prepare", type: "post", data: I.with_csrf(r), dataType: "json" })).then(function (n) { return n.errors ? $.Deferred().reject(n) : n }) }) }, Me = function (t) { var e, r, n, i, o; return e = new DataView(t, 0, 5), n = e.getUint8(0, !0), i = e.getUint8(1, !0), r = n.toString(16) + i.toString(16), o = { 8950: "image/png", 4749: "image/gif", "424d": "image/bmp", ffd8: "image/jpeg" }, o[r] }, te = "You selected an image type we don't recognize. It's possible it has the wrong file extension for the format it is saved as. Please use an image editing program to convert it to a PNG, JPEG, or GIF.", I.test_image_format = function (t) { return $.Deferred(function (e) { return function (r) { var n; return window.FileReader ? (n = new FileReader, n.readAsArrayBuffer(t), n.onerror = function () { return r.reject("Failed to read image from disk") }, n.onload = function () { var i; return i = Me(n.result), i === "image/bmp" ? r.reject("You selected a BMP file that has a wrong extension. Please use an image editing program to convert it to a PNG, JPEG, or GIF.") : i ? r.resolve() : r.reject(te) }) : r.resolve() } }(this)) }, I.image_dimensions = function (t) { return $.Deferred(function (e) { var r, n; return n = typeof URL != "undefined" && URL !== null && typeof URL.createObjectURL == "function" ? URL.createObjectURL(t) : void 0, n ? (r = new Image, r.src = n, r.onload = function () { return e.resolve([r.width, r.height]) }, r.onerror = function () { return e.reject(te) }) : e.reject(te) }) }, I.video_dimensions = function (t) { return $.Deferred(function (e) { var r, n; return n = document.createElement("video"), r = typeof URL != "undefined" && URL !== null && typeof URL.createObjectURL == "function" ? URL.createObjectURL(t) : void 0, r ? (n.src = r, n.onloadedmetadata = function () { return e.resolve([n.videoWidth, n.videoHeight]) }, n.onerror = function () { return e.reject("Invalid video file") }) : e.reject("Invalid video file") }) }, I.test_image_dimensions = function (t, e, r) { return e == null && (e = 3840), r == null && (r = 2160), I.image_dimensions(t).then(function (n) { return function (i) { var o, a; return a = i[0], o = i[1], $.Deferred(function (s) { return a > e || o > r ? s.reject("Image is greater than the maximum dimensions of " + e + "x" + r + " (you selected a " + a + "x" + o + " image)") : s.resolve() }) } }(this)) }; var Ct = I.Upload = function () { t.prototype.kind = "upload"; function t(e, r, n) { this.editor = e, this.file = r, this.opts = n != null ? n : {}, this.save_upload = V(this.save_upload, this), this.decrement = V(this.decrement, this), this.increment = V(this.increment, this) } return t.prototype.upload_params = function () { return { kind: this.kind, filename: this.file.name } }, t.prototype.progress = function (e, r) { }, t.prototype.save_params = function () { return {} }, t.prototype.save_url = function () { return this.upload_data.success_url }, t.prototype.start_upload = function () { if (this.upload_data) { console.warn("Attempt to start_upload when upload has already been started"); return } return this.prepare_upload().then(function (e) { return function () { return e.start_xhr_upload() } }(this)).then(function (e) { return function () { return e.save_upload() } }(this)) }, t.prototype.increment = function () { var e, r; if ((e = this.constructor).active_uploads || (e.active_uploads = 0), this.constructor.active_uploads++, this.constructor.active_uploads === 1) return typeof (r = this.opts).start_uploading == "function" ? r.start_uploading() : void 0 }, t.prototype.decrement = function () { var e; if (this.constructor.active_uploads--, this.constructor.active_uploads === 0) return typeof (e = this.opts).stop_uploading == "function" ? e.stop_uploading() : void 0 }, t.prototype.prepare_upload = function () { return this.editor.prepare_upload().then(function (e) { return function () { return I.prepare_upload(e.editor.upload_prefix(), e.upload_params()).done(function (r) { e.upload_data = r }) } }(this)) }, t.prototype.start_xhr_upload = function () { var e, r, n, i, o, a; if (!this.upload_data) throw "missing upload data"; this.increment(), e = $.Deferred().always(function (s) { return function () { return s.decrement() } }(this)), r = new FormData, i = this.upload_data.post_params; for (n in i) o = i[n], r.append(n, o); return r.append("file", this.file), a = new XMLHttpRequest, a.upload.addEventListener("progress", function (s) { return function (u) { if (u.lengthComputable) return s.progress(u.loaded, u.total) } }(this)), a.upload.addEventListener("error", function (s) { return function (u) { return I.event("upload", "xhr error", s.kind) } }(this)), a.upload.addEventListener("abort", function (s) { return function (u) { return I.event("upload", "xhr abort", s.kind) } }(this)), a.addEventListener("readystatechange", function (s) { return function (u) { var l; if (a.readyState === 4) { if (Math.floor(a.status / 100) === 2) return I.event("upload", "save", s.kind), e.resolve(); if (l = "Failed upload.", a.responseXML) try { l = a.responseXML.querySelector("Error Message").innerHTML } catch (c) { u = c } else l = a.responseText; return I.event("upload_error", "server error " + a.status + ": " + l, s.kind), e.reject({ errors: [l] }) } } }(this)), a.open("POST", this.upload_data.action), a.send(r), e }, t.prototype.save_upload = function () { if (!this.upload_data) { console.warn("attempted to call save_upload without upload_data"); return } return Le($.ajax({ url: this.save_url(), data: I.with_csrf(this.save_params()), dataType: "json", type: "post" })).then(function (e) { return function (r) { return r.errors ? $.Deferred().reject(r) : r } }(this)) }, t }(), Rt = I.ImageUpload = function (t) { De(e, t); function e() { return e.__super__.constructor.apply(this, arguments) } return e.prototype.kind = "image", e.delete_image = function (r, n, i) { return $.ajax({ url: r.upload_prefix() + "/image/delete/" + n, type: "post", data: I.with_csrf(), success: i }) }, e }(I.Upload), Tt = function (t) { De(e, t), e.prototype.stage_delay = 500, e.prototype.mock_prepare_result = { id: 123 }, e.prototype.mock_save_result = { success: !0 }; function e() { this.save_upload = V(this.save_upload, this), this.start_xhr_upload = V(this.start_xhr_upload, this), this.prepare_upload = V(this.prepare_upload, this), e.__super__.constructor.apply(this, arguments), console.warn("MockUpload:new " + this.file.name) } return e.prototype.prepare_upload = function () { return console.warn("MockUpload: prepare_upload"), this.editor.prepare_upload().then(function (r) { return function () { return $.Deferred(function (n) { return setTimeout(function () { return r.upload_data = r.mock_prepare_result, n.resolve(r.upload_data) }, r.stage_delay) }) } }(this)) }, e.prototype.start_xhr_upload = function () { var r, n, i, o, a, s; return console.warn("MockUpload: start_xhr_upload"), r = 20, i = (o = this.file.size) != null ? o : 1234, n = 0, s = 0, a = this.stage_delay / r * 5, $.Deferred(function (u) { return function (l) { var c; return u.progress(0, i), c = function () { return setTimeout(function () { return s += 1, u.progress(Math.floor(s / r * i), i), s === r ? l.resolve() : c() }, a) }, c() } }(this)) }, e.prototype.save_upload = function () { return console.warn("MockUpload: save_upload"), $.Deferred(function (r) { return function (n) { return setTimeout(function () { return n.resolve(r.mock_save_result) }, r.stage_delay) } }(this)) }, e }(I.Upload); I.pick_files = function (t) { var e; return t == null && (t = {}), e = t.input ? $(t.input) : ($("input.pick_files_input").remove(), $("<input type='file' class='pick_files_input' />").hide().insertAfter("body")), $.Deferred(function (r) { return function (n) { return t.multiple && e.attr("multiple", !0), t.accept && e.attr("accept", t.accept), e.on("change", function (i) { var o, a, s, u, l, c, p; for (l = function () { var h, v, y, w; for (y = i.target.files, w = [], h = 0, v = y.length; h < v; h++)s = y[h], w.push(s); return w }(), a = [], typeof t.on_pick_files == "function" && t.on_pick_files(l), c = 0, p = l.length; c < p; c++)u = l[c], t.max_size && u.size > t.max_size && a.push(["You selected an image greater than the max size " + I.format_bytes(t.max_size) + " (you selected a " + I.format_bytes(u.size) + " file)", u]); if (a.length) { n.reject(a, l); return } return t.test_file ? (o = l.map(function (h) { return $.Deferred(function (v) { return t.test_file(h, v), setTimeout(function () { if (n.state() === "pending") return v.reject("Timed out checking file, are you sure it was an image file?") }, 1e3) }).catch(function (v) { throw [v, h] }) }), $.when.apply($, o).done(function (h) { return n.resolve(l) }).fail(function (h) { return n.reject([h]) })) : n.resolve(l) }), e.click() } }(this)) }, I.xhr_upload = function (t, e) { return $.Deferred(function (r) { return function (n) { var i, o, a, s, u; i = new FormData, a = e.post_params; for (o in a) s = a[o], i.append(o, s); return i.append("file", t), u = new XMLHttpRequest, u.upload.addEventListener("progress", function (l) { if (l.lengthComputable) return n.notify("progress", l.loaded, l.total) }), u.upload.addEventListener("error", function (l) { return n.reject("xhr error") }), u.upload.addEventListener("abort", function (l) { return n.reject("xhr aborted") }), u.addEventListener("readystatechange", function (l) { var c; if (u.readyState === 4) { if (Math.floor(u.status / 100) === 2) return n.resolve(); if (c = "Failed upload.", u.responseXML) try { c = u.responseXML.querySelector("Error Message").innerHTML } catch (p) { l = p } else c = u.responseText; return n.reject(c) } }), u.open("POST", e.action), u.send(i) } }(this)) }, I.upload_image = function (t) { return t == null && (t = {}), t.accept || (t.accept = "image/png,image/jpeg,image/gif"), t.file_params = function (e) { return e.type === "video/mp4" ? I.video_dimensions(e).then(function (r) { return function (n) { var i, o; return o = n[0], i = n[1], { width: o, height: i } } }(this)) : I.image_dimensions(e).then(function (r) { return function (n) { var i, o; return o = n[0], i = n[1], { width: o, height: i } } }(this)) }, I.upload_file(t) }, I.upload_file = function (t) { var e, r, n, i, o, a; if (t == null && (t = {}), !t.url) throw new Error("missing url for upload image"); return e = t.accept, r = t.max_size, n = t.multiple, i = t.on_pick_files, o = t.on_start_upload, a = t.test_file, I.pick_files({ accept: e, max_size: r, multiple: n, test_file: a, on_pick_files: i }).then(function (s) { return function (u) { var l, c; if (!n && u.length > 1) throw "Got multiple files for single upload"; return c = function () { var p, h, v, y; for (v = u.slice(0, 6), y = [], p = 0, h = v.length; p < h; p++)l = v[p], y.push(function (w) { var k; return k = t.file_params ? t.file_params(w) : {}, $.when(k).then(function (x) { return function (S) { return $.ajax({ url: t.url, type: "post", xhrFields: { withCredentials: !0 }, data: I.with_csrf($.extend({ filename: w.name, thumb_size: t.thumb_size, action: "prepare" }, S)) }).then(function (C) { var f; return C.errors ? $.Deferred().reject(C.errors) : (f = I.xhr_upload(w, C).then(function () { return $.ajax({ url: C.success_url, type: "post", xhrFields: { withCredentials: !0 }, data: I.with_csrf() }) }), typeof o == "function" && o(w, C, f), f) }) } }(this)) }(l)); return y }(), n ? $.when.apply($, c) : c[0] } }(this)) }, I.make_upload_button = function (t, e) { var r, n; return r = null, n = t.data("max_size"), t.on("click", function (i) { return function (o) { var a; return r && r.remove(), r = $("<input type='file' multiple />").hide().insertAfter(t), (a = t.data("accept")) && r.attr("accept", a), r.on("change", function () { var s, u, l, c, p; for (c = r[0].files, p = [], u = 0, l = c.length; u < l; u++) { if (s = c[u], n != null && s.size > n) { I.flash(s.name + " is greater than max size of " + I.format_bytes(n), "error"); continue } p.push(typeof e == "function" ? e(s) : void 0) } return p }), r.insertAfter(t), r.click() } }(this)) }, I.VideoEmbed = function () { function t(e) { this.el = $(e), this.el.lazy_images({ selector: ".video_drop", show_item: function (r) { return function (n) { return n.replaceWith(n.data("template")) } }(this) }) } return t }(), I.libs.react.done(function () { var t, e, r, n, i, o, a; return t = Y, r = t.button, o = t.span, n = t.img, e = t.a, i = t.label, a = PropTypes, R("FollowButton", { propTypes: { following: a.bool, show_name: a.bool, name: a.string, login_url: a.string, user_id: a.number, follow_data: a.object, follow_url: a.string.isRequired, unfollow_url: a.string.isRequired }, getInitialState: function () { return { following: this.props.following } }, getDefaultProps: function () { return { show_name: !0 } }, componentDidUpdate: function (s, u) { if (!u.animate_class && this.state.animate_class) return this.timer && (window.clearTimeout(this.timer), delete this.timer), this.timer = setTimeout(function (l) { return function () { return l.setState({ animate_class: null }) } }(this), 500) }, componentWillUnmount: function () { if (this.timer) return window.clearTimeout(this.timer), delete this.timer }, render: function () { var s; return s = this.state.following ? this.state.hovering ? this.props.show_name ? this.tt("misc.follow_button.unfollow_username", { username: this.props.name }) : this.tt("misc.follow_button.unfollow") : React.createElement(React.Fragment, {}, o({ className: "icon icon-checkmark", "aria-hidden": !0, role: "img" }), this.props.show_name ? this.tt("misc.follow_button.following_username", { username: this.props.name }) : this.tt("misc.follow_button.following")) : React.createElement(React.Fragment, {}, o({ className: "icon icon-plus", "aria-hidden": !0, role: "img" }), this.props.show_name ? this.tt("misc.follow_button.follow_username", { username: this.props.name }) : this.tt("misc.follow_button.follow")), this.enclose({ component: this.props.login_url ? "a" : "button", href: this.props.login_url, "data-label": "follow_btn", className: classNames("button", { is_following: this.state.following, disabled: this.state.loading }, this.state.animate_class, this.props.className), onMouseEnter: function (u) { return function () { return u.setState({ hovering: !0 }) } }(this), onMouseLeave: function (u) { return function () { return u.setState({ hovering: !1 }) } }(this), target: this.props.target, onClick: function (u) { return function (l) { var c, p; if (!u.props.login_url && !u.state.loading) return l.preventDefault(), c = $(l.target), u.setState({ loading: !0, animate_class: null }), u.container().trigger("i:track_link"), p = u.state.following ? u.props.unfollow_url : u.props.follow_url, $.post(p, I.with_csrf(u.props.follow_data), function (h) { if (h.errors) { I.flash(h.errors.join(", ")), u.setState({ loading: !1 }); return } return c.trigger("i:follow_updated", [{ user_id: u.props.user_id, following: h.following, btn: c }]), u.setState({ following: h.following, animate_class: h.following ? "animate_bounce" : "animate_drop_down", loading: !1 }, function () { var v; return typeof (v = u.props).on_follow_change == "function" ? v.on_follow_change(u.state.following) : void 0 }) }) } }(this) }, s) } }) }); var Ee = null; z.libs.react.done(function () { var t, e; return t = Y, e = t.div, Ee = A.component("SlideDown", { getInitialState: function () { return {} }, getDefaultProps: function () { return { duration: 200, delay: 1 } }, componentDidMount: function () { return this.timer = window.setTimeout(function (r) { return function () { var n; return n = r.wrapper_ref.current, r.setState({ height: n.scrollHeight || !1 }), r.timer = window.setTimeout(function () { return r.setState({ animated: !0 }) }, r.props.duration + 50), n.scrollTop = 0 } }(this), this.props.delay) }, componentWillUnmount: function () { if (this.timer) return window.clearTimeout(this.timer), delete this.timer }, render: function () { var r; return r = this.state.height === !1 ? null : this.state.height ? this.state.animated ? null : { height: this.state.height + "px", overflow: "hidden", transition: "height " + this.props.duration / 1e3 + "s ease" } : { height: 0, overflow: "scroll", transition: "height 0.2s ease" }, e({ style: r, className: this.props.className, ref: this.wrapper_ref || (this.wrapper_ref = D.createRef()) }, this.props.children) } }) }); var vt = [].slice, wt = null; I.libs.react.done(function () { var t, e, r, n, i, o, a, s, u, l, c, p, h, v, y, w, k, x, S, C; return r = Y, l = r.input, u = r.img, o = r.div, c = r.label, x = r.span, y = r.p, v = r.option, h = r.optgroup, k = r.select, C = r.ul, p = r.li, n = r.button, w = r.section, a = r.form, S = r.strong, s = r.fragment, s = D.createElement.bind(null, D.Fragment), s.type = D.fragment, i = function (f) { return function () { return A.component.apply(A, arguments) } }(this), i("CSRF", { pure: !0, render: function () { return l({ type: "hidden", name: "csrf_token", value: $("meta[name=csrf_token]").attr("value") }) } }), t = function (f) { return D.createElement("svg", { className: "svgicon icon_down_tick2", strokeLinecap: "round", stroke: "currentColor", role: "img", version: "1.1", viewBox: "0 0 24 24", strokeWidth: "2", width: "22", height: "22", strokeLinejoin: "round", "aria-hidden": !0, fill: "none" }, D.createElement("polyline", { points: "6 9 12 15 18 9" })) }, t = D.createElement.bind(null, D.memo(t)), e = A.package("Forms"), e("InputRow", { pure: !0, propTypes: { title: M.string, sub: M.any }, render: function () { var f; return f = D.createElement(D.Fragment, {}, o({ className: "label", key: "label" }, this.props.title, this.props.sub ? x({ className: "sub" }, " \u2014 ", this.props.sub) : void 0), this.props.children), this.props.multi || (f = c({ children: f })), o({ className: F("input_row", this.props.className), id: this.props.id }, f) } }), e("TextInputRow", { pure: !0, propTypes: { title: M.string, sub: M.any, name: M.string.isRequired, value: M.any }, focus: function () { return this.input_ref.current.focus() }, get_input_el: function () { return this.input_ref.current }, get_value: function () { return this.input_ref.current.value }, componentDidMount: function () { var f; if (this.props.money_input) { if (!this.props.currency) throw new Error("missing currency"); I.money_input(this.input_ref.current, { currency: this.props.currency }) } if (this.props.slug_input && I.slug_input($(this.input_ref.current)), this.props.integer_input) return f = /[0-9]/g, $(this.input_ref.current).on("keypress", function (d) { return function (g) { var b; if (g.keyCode >= 32 && (b = String.fromCharCode(g.keyCode), !b.match(f))) return !1 } }(this)) }, render: function () { var f; return f = [o({ className: "label", key: "label" }, this.props.title, this.props.sub ? x({ className: "sub" }, " \u2014 ", this.props.sub) : void 0), l({ type: "text", key: "input", name: this.props.name, ref: this.input_ref || (this.input_ref = D.createRef()), value: this.props.value, defaultValue: this.props.defaultValue, onChange: this.props.onChange, onKeyUp: this.props.onKeyUp, onFocus: this.props.onFocus, onBlur: this.props.onBlur, onClick: this.props.onClick, readOnly: this.props.readonly, className: F({ has_error: this.props.has_error }), required: this.props.required, placeholder: this.props.placeholder, disabled: this.props.disabled, pattern: this.props.pattern }), this.props.error_message ? y({ key: "error", className: "input_error" }, this.props.error_message) : void 0], this.props.multi || (f = c({ children: f })), o({ className: F("input_row", this.props.className) }, f) } }), e("SimpleSelect", { pure: !0, propTypes: { options: M.array.isRequired, name: M.string }, getInitialState: function () { return { value: this.props.defaultValue ? this.props.defaultValue : void 0 } }, render: function () { var f, d, g, b, j; return d = this.current_option(), j = this.props.render_current_option, j || (j = function (L) { return function (T) { return T.short_name || T.name } }(this)), f = [], g = null, b = function () { if (g) return f.push(h.apply(null, [{ label: g.label, key: "group-" + f.length }].concat(vt.call(g.children)))), g = null }, this.props.options.map(function (L) { return function (T, E) { var P; return P = v({ key: "" + E, value: T.value }, T.name), T.group ? ((g != null ? g.label : void 0) !== T.group && b(), g || (g = { label: T.group, children: [] }), g.children.push(P)) : (b(), f.push(P)) } }(this)), b(), this.enclose({ className: F({ focused: this.state.focused, disabled: this.props.disabled, has_value: d !== this.props.options[0] }) }, o({ className: "selected_option" }, x({ className: "selected_option_name" }, j(d)), t({})), k({ ref: this.select_ref || (this.select_ref = D.createRef()), disabled: this.props.disabled, value: d.value, name: this.props.name, onFocus: function (L) { return function (T) { return L.setState({ focused: !0 }) } }(this), onBlur: function (L) { return function (T) { return L.setState({ focused: !1 }) } }(this), onChange: this.on_change, children: f })) }, on_change: function (f) { var d; return d = f.target.value, this.props.onChange ? d === this.props.value ? void 0 : this.props.onChange(d) : d === this.state.value ? void 0 : this.setState({ value: d }) }, find_option: function (f) { var d, g, b, j; for (j = this.props.options, d = 0, g = j.length; d < g; d++)if (b = j[d], b.value === f) return b }, current_option: function () { var f, d; return d = this.props.value || this.state.value, f = d != null ? this.find_option(d) : void 0, f || this.props.options[0] } }), e("Select", { propTypes: { name: M.string.isRequired, value: M.any, options: M.array.isRequired }, componentDidMount: function () { var f, d; if (this.props.selectize && (d = this.props.selectize === !0 ? {} : this.props.selectize, f = $(this.input_ref.current), f.selectize(d), this.props.onChange)) return f.on("change", function (g) { return function (b) { return g.props.onChange(b) } }(this)) }, render: function () { return k({ ref: this.input_ref || (this.input_ref = D.createRef()), name: this.props.name, onChange: this.props.onChange, value: this.props.value, defaultValue: this.props.defaultValue, children: this.props.options.map(function (f) { return function (d) { var g, b; return b = d[0], g = d[1], v({ key: b, value: b }, g || b) } }(this)) }) } }), e("RadioButtons", { propTypes: { name: M.string.isRequired, value: M.any, options: M.array.isRequired }, getValue: function () { var f, d, g, b, j, L; for (b = this.container().find("input").serializeArray(), f = 0, d = b.length; f < d; f++)return j = b[f], g = j.name, L = j.value, L }, render: function () { return C({ className: "radio_list", children: this.props.options.map(function (f) { return function (d, g) { var b, j, L, T; return T = d[0], b = d[1], L = d[2], j = d[3], p({ key: T != null ? T : g, className: F({ disabled: j != null ? j.disabled : void 0 }) }, c({}, l($.extend({ type: "radio", name: f.props.name, value: T, defaultChecked: f.props.defaultValue ? T === f.props.defaultValue : void 0, checked: f.props.value != null ? T === f.props.value : void 0, onChange: f.props.onChange }, j)), x({ className: "radio_label" }, b), L ? x({ className: "sub" }, " \u2014 ", L) : void 0)) } }(this)) }) } }), e("Slider", { pure: !0, propTypes: { min: M.number, max: M.number, value: M.number, onChange: M.func, disabled: M.bool }, getInitialState: function () { return {} }, on_change: function (f) { return f = Math.round(f), this.props.onChange ? this.props.value === f ? void 0 : this.props.onChange(f) : this.state.value === f ? void 0 : this.setState({ value: f }) }, start_drag: function (f, d) { var g, b, j, L; if (!this.props.disabled) return L = this.track_ref.current.clientWidth, b = this.current_value(), this.setState({ dragging: !0 }), g = function (T) { return function (E) { var P, N, q, W; if (E.preventDefault(), E.buttons === 0) { j(); return } if (q = E.pageX, W = E.pageX, P = q - f, N = P / L * (T.props.max - T.props.min) + b, N = Math.min(T.props.max, Math.max(T.props.min, N)), N !== T.current_value()) return T.on_change(N) } }(this), j = function (T) { return function (E) { return E != null && E.preventDefault(), T.setState({ dragging: !1 }), document.body.removeEventListener("mousemove", g), document.body.removeEventListener("mouseup", j), delete T.up_listener } }(this), document.body.addEventListener("mousemove", g), document.body.addEventListener("mouseup", j), this.up_listener = j }, current_value: function () { return "value" in this.state ? this.state.value || this.props.min : this.props.value || this.props.min }, percent: function () { return (this.current_value() - this.props.min) / (this.props.max - this.props.min) }, componentWillUnmount: function () { if (this.up_listener) return this.up_listener() }, render: function () { var f; return f = { left: this.percent() * 100 + "%" }, this.enclose({ className: F("slider_input", { disabled: this.props.disabled }), onClick: function (d) { return function (g) { var b, j; if (!d.props.disabled && g.target !== d.slider_nub_ref.current && (j = d.track_ref.current.getBoundingClientRect(), y = Math.min(j.width, Math.max(0, g.pageX - j.left)) / j.width, b = d.props.min + y * (d.props.max - d.props.min), b = Math.min(d.props.max, Math.max(d.props.min, b)), b !== d.current_value())) return d.on_change(b) } }(this) }, this.props.name ? l({ type: "hidden", name: this.props.name, value: this.current_value() }) : void 0, o({ ref: this.track_ref || (this.track_ref = D.createRef()), className: "slider_track" }, o({ className: "slider_fill", style: { width: this.percent() * 100 + "%" } }), this.state.focused && this.props.show_tooltip ? o({ style: f, className: "value_tooltip" }, this.current_value()) : void 0, n({ type: "button", ref: this.slider_nub_ref || (this.slider_nub_ref = D.createRef()), className: F("slider_nub", { disabled: this.props.disabled }), onFocus: function (d) { return function () { return d.setState({ focused: !0 }) } }(this), onBlur: function (d) { return function () { return d.setState({ focused: !1 }) } }(this), onMouseDown: function (d) { return function (g) { return d.start_drag(g.pageX, g.pageY) } }(this), onKeyDown: function (d) { return function (g) { switch (g.keyCode) { case 37: d.on_change(Math.max(d.props.min, d.current_value() - 1)); break; case 39: d.on_change(Math.min(d.props.max, d.current_value() + 1)); break; default: return }return g.preventDefault() } }(this), style: f }))) } }), e("FilterPicker", { pure: !0, componentWillUnmount: function () { return $(window).off("click", this.window_click_listener) }, getDefaultProps: function () { return { label_padding: 3 } }, getInitialState: function () { return { open: !1 } }, close_picker: function () { if (this.state.open) return this.setState({ open: !1, popup_visible: !1 }), $(window).off("click", this.window_click_listener) }, open_picker: function () { var f, d; return f = this.open_button_ref.current, d = f.getBoundingClientRect(), this.window_click_listener && $(window).off("click", this.window_click_listener), this.window_click_listener = function (g) { return function (b) { if (i = $(b.target).closest(g.container()), !i.length) return g.close_picker() } }(this), $(window).on("click", this.window_click_listener), this.setState({ open: !0, top: -this.props.label_padding, left: -this.props.label_padding, height: d.height + this.props.label_padding * 2 }, function (g) { return function () { return g.filter_popup_ref.current.focus(), _.defer(function () { if (g.window_click_listener && g.state.open) return g.setState({ popup_visible: !0 }) }) } }(this)) }, render: function () { return this.enclose({ className: F("filter_picker_widget", { open: this.state.open, popup_visible: this.state.popup_visible }), onKeyDown: this.state.open ? function (f) { return function (d) { if (d.keyCode === 27) return f.close_picker() } }(this) : void 0 }, n({ type: "button", className: "filter_value", ref: this.open_button_ref || (this.open_button_ref = D.createRef()), onClick: this.state.open ? this.close_picker : this.open_picker }, x({ className: "value_label" }, this.props.label), t({})), o({ tabIndex: -1, ref: this.filter_popup_ref || (this.filter_popup_ref = D.createRef()), className: "filter_popup", style: { top: (this.state.top || 0) + "px", left: (this.state.left || 0) + "px" } }, o({ style: { marginTop: (this.state.height || 0) + "px" }, className: "filter_options" }, this.props.render_children ? this.state.open ? this.props.render_children() : void 0 : this.props.children))) } }), e("StarPicker", { pure: !0, getDefaultProps: function () { return { total_stars: 5, star_filled: "icon-star", star_empty: "icon-star2" } }, getInitialState: function () { return {} }, set_value: function (f) { var d; return this.props.set_value ? this.props.set_value(f) : this.setState({ value: f }), typeof (d = this.props).on_change == "function" ? d.on_change(f) : void 0 }, render: function () { var f, d, g, b, j, L, T; return T = (g = (b = (j = this.props.value) != null ? j : this.state.value) != null ? b : this.props.defaultValue) != null ? g : 0, f = this.state.preview_value || T, L = function () { var E, P, N; for (N = [], d = E = 1, P = this.props.total_stars; 1 <= P ? E <= P : E >= P; d = 1 <= P ? ++E : --E)N.push(function (q) { return function (W) { var Pe, Ne, fe; return Pe = W > f ? "star icon " + q.props.star_empty : "star icon " + q.props.star_filled, Ne = T === W, fe = W + " Star" + (W === 1 ? "" : "s"), n({ key: "star-" + W, type: "button", title: fe, role: "radio", "aria-describedby": q.props["aria-describedby"], "aria-label": fe, "aria-checked": Ne ? "true" : "false", onMouseEnter: function () { return q.setState({ preview_value: W }) }, onMouseLeave: function () { return q.setState({ preview_value: null }) }, onClick: function () { return q.set_value(W) } }, x({ className: Pe })) } }(this)(d)); return N }.call(this), this.enclose({ "aria-labelledby": this.props["aria-labelledby"], role: "radiogroup", className: F(this.props.className, { interactive: !0, previewing: this.state.preview_value != null, has_value: T > 0 }) }, this.props.name ? l({ type: "hidden", name: this.props.name, value: T > 0 ? T : "" }) : void 0, L) } }), e("EditableInput", { getInitialState: function () { return { value: null, edit_value: null } }, componentDidUpdate: function (f) { var d; if (d = this.state.value ? this.state.value : this.props.value, this.props.value !== d) return this.setState({ value: this.props.value, edit_value: null }) }, confirm_edit: function () { if (this.state.edit_value) return this.setValue(this.state.edit_value) }, cancel_edit: function () { return this.setState({ edit_value: null }) }, setValue: function (f) { var d; return this.setState({ value: f, edit_value: null }), typeof (d = this.props).onUpdate == "function" ? d.onUpdate(f) : void 0 }, render: function () { var f; return l({ type: (f = this.props.type) != null ? f : "text", className: this.props.className, name: this.props.name, title: this.props.title, readOnly: this.props.readonly, required: this.props.required, placeholder: this.props.placeholder, disabled: this.props.disabled, pattern: this.props.pattern, value: this.state.edit_value !== null ? this.state.edit_value : this.state.value !== null ? this.state.value : this.props.value, onKeyDown: function (d) { return function (g) { if (g.keyCode === 27 && (d.cancel_edit(), g.stopPropagation()), g.keyCode === 13) return d.confirm_edit(), g.stopPropagation() } }(this), onFocus: function (d) { return function (g) { return g.target.select() } }(this), onBlur: function (d) { return function (g) { return d.confirm_edit() } }(this), onChange: function (d) { return function (g) { return d.setState({ edit_value: g.target.value }) } }(this) }) } }), e("FocusButton", { pure: !0, getInitialState: function () { return { focused: !1 } }, componentWillUnmount: function () { var f; if (this.state.focused) return typeof (f = this.props).on_decrement_focus == "function" ? f.on_decrement_focus() : void 0 }, on_focus: function () { var f; return this.setState({ focused: !0 }), typeof (f = this.props).on_increment_focus == "function" ? f.on_increment_focus() : void 0 }, on_blur: function () { var f; return this.setState({ focused: !1 }), typeof (f = this.props).on_decrement_focus == "function" ? f.on_decrement_focus() : void 0 }, render: function () { var f; return f = $.extend({ onFocus: this.on_focus, onBlur: this.on_blur }, this.props), delete f.on_increment_focus, delete f.on_decrement_focus, n(f) } }), wt = e("FormErrors", { pure: !0, getDefaultProps: function () { return { animated: !1, scroll_into_view: !1 } }, propTypes: { title: M.string, errors: M.array.isRequired }, render: function () { var f; return f = this.props.animated ? Ee : w, f({ className: F(this.enclosing_class_name(), "form_errors"), role: "alert" }, o({ ref: this.props.scroll_into_view ? function (d) { if (d) return typeof d.scrollIntoView == "function" ? d.scrollIntoView() : void 0 } : void 0 }, this.props.title !== !1 ? y({}, S({}, this.props.title || this.tt("misc.forms.form_errors"))) : void 0, C({}, this.props.errors.map(function (d) { return function (g) { var b; return b = g === "recaptcha" ? "Please complete the CAPTCHA to continue" : g, p({ key: g }, b) } }(this))), this.props.children)) } }), e("RecaptchaInput", { propTypes: { sitekey: M.string.isRequired }, componentDidMount: function () { return I.with_recaptcha(function (f) { return function () { var d; return I.event("recaptcha", "show", I.page_name()), d = Se.findDOMNode(f), grecaptcha.render(d, { sitekey: f.props.sitekey }) } }(this)) }, render: function () { return o({ className: "g-recaptcha" }) } }), e("SubmitChallenge", { pure: !0, getInitialState: function () { return {} }, solve_deferred: function () { var f, d; return this.props.challenge === this.state.challenge ? this.state.deferred : (f = $.Deferred(), d = +new Date, this.setState({ challenge: this.props.challenge, solution: null, duration: null, busy: !0, deferred: f }), I.solve_challenge(this.props.challenge).then(function (g) { return function (b) { return g.setState({ busy: !1, duration: new Date - d, solution: b }) } }(this)), f) }, render: function () { var f; return f = this.state.solution || "", s({}, l({ type: "hidden", name: "challenge", value: this.props.challenge }), l({ key: f, type: "hidden", name: "challenge_response", value: f, ref: function (d) { return function (g) { var b; if (g && d.state.solution) return (b = d.state.deferred) != null ? b.resolve() : void 0 } }(this) })) } }) })
})();
